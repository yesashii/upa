sql =  "SELECT con.cont_ncorr AS ciudad_codeudor1, pag.pupa_ncorr nro_pagare, \n ";
			sql = sql + "(select SUM(di.DING_MDOCTO) from contratos cc, pagare_upa pag, compromisos com, ABONOS a, INGRESOS i, detalle_ingresos di WHERE cc.cont_ncorr = com.COMP_NDOCTO AND cc.cont_ncorr = pag.cont_ncorr AND com.tcom_ccod = 2 AND cc.POST_NCORR = p.post_ncorr AND di.TING_CCOD=dii.TING_CCOD AND ISNULL(pag.opag_ccod, 1) NOT IN (2) AND a.COMP_NDOCTO = com.COMP_NDOCTO AND i.INGR_NCORR = a.INGR_NCORR AND di.INGR_NCORR = a.INGR_NCORR and com.ecom_ccod <> 3  ) AS valor_pagar, \n";
			sql = sql + "(select COUNT(*) from contratos cc, pagare_upa pag, compromisos com, ABONOS a, INGRESOS i, detalle_ingresos di WHERE cc.cont_ncorr = com.COMP_NDOCTO AND cc.cont_ncorr = pag.cont_ncorr AND com.tcom_ccod = 2 AND cc.POST_NCORR = p.post_ncorr AND di.TING_CCOD=dii.TING_CCOD AND ISNULL(pag.opag_ccod, 1) NOT IN (2) AND a.COMP_NDOCTO = com.COMP_NDOCTO AND i.INGR_NCORR = a.INGR_NCORR AND di.INGR_NCORR = a.INGR_NCORR and com.ecom_ccod <> 3  )  AS NUMERO_CUOTAS, \n ";
			sql = sql + " cast(DATEPART(dd, GETDATE()) AS varchar) dd_hoy,protic.trunc(dii.ding_fdocto) as fecha_pago, \n ";
			sql = sql + " (SELECT mes_tdesc FROM meses WHERE mes_ccod = DATEPART(mm, GETDATE()))AS mm_hoy, \n ";
			sql = sql + " cast(DATEPART(mm, GETDATE()) AS varchar) mm_antiguo,\n "; 
			sql = sql + " dii.ding_tcuenta_corriente cuenta_cte,(select banc_tdesc from bancos where banc_ccod=dii.banc_ccod) as banco ,\n";
			sql = sql + " cast(DATEPART(yy, GETDATE())AS varchar) yy_hoy, ciu.ciud_tdesc \n ";
			sql = sql + " ciudad_sede, pac.anos_ccod periodo_academico, (pac.anos_ccod + 1) AS inicio_vencimiento, \n ";
			sql = sql + "(pac.anos_ccod + 2) AS final_vencimiento, cast(pp.pers_nrut AS varchar) + '-' + cast(pp.pers_xdv AS varchar) AS rut_post, \n ";
			sql = sql + " pp.pers_tnombre + ' ' + pp.pers_tape_paterno + ' ' + pp.pers_tape_materno AS nombre_alumno, \n ";
			sql = sql + " cc.carr_tdesc AS carrera, cast(ppc.pers_nrut AS varchar) + '-' + cast(ppc.pers_xdv AS varchar) AS rut_codeudor, \n ";
			sql = sql + " ppc.pers_tnombre + ' ' + ppc.pers_tape_paterno + ' ' + ppc.pers_tape_materno \n ";
			sql = sql + " AS nombre_codeudor, ddc.dire_tcalle + ' ' + cast(ddc.dire_tnro AS varchar)+' '+ case ddc.DIRE_TBLOCK when '' then '' else 'Depto '+cast(ddc.DIRE_TBLOCK as varchar) end AS direccion_codeudor, \n ";
			sql = sql + " c.ciud_tcomuna ciudad_codeudor, ddp.dire_tcalle + ' ' + cast(ddp.dire_tnro AS varchar) AS direccion_postulante,\n ";
			sql = sql + "  ccp.ciud_tdesc ciudad_codeudor1_x_contrato,dii.ding_mdetalle as valor_cuota,c.ciud_tdesc comuna_codeudor \n ";
			sql = sql + " FROM postulantes p \n ";
			sql = sql + " join personas_postulante pp \n ";
			sql = sql + "     on p.pers_ncorr = pp.pers_ncorr \n ";
			sql = sql + " join codeudor_postulacion cp \n ";
			sql = sql + "     on p.post_ncorr = cp.post_ncorr \n ";
			sql = sql + " join personas_postulante ppc \n ";
			sql = sql + "     on cp.pers_ncorr = ppc.pers_ncorr \n ";
			sql = sql + " join ofertas_academicas oa \n ";
			sql = sql + "     on p.ofer_ncorr = oa.ofer_ncorr \n ";
			sql = sql + " join especialidades ee \n ";
			sql = sql + "     on oa.espe_ccod = ee.espe_ccod \n ";
			sql = sql + " join carreras cc \n ";
			sql = sql + "     on ee.carr_ccod = cc.carr_ccod \n ";
			sql = sql + " join direcciones_publica ddp \n ";
			sql = sql + "     on pp.pers_ncorr = ddp.pers_ncorr \n ";
			sql = sql + " left outer join ciudades ccp \n ";
			sql = sql + "     on ddp.ciud_ccod =ccp.ciud_ccod \n ";
			sql = sql + " join direcciones_publica ddc \n ";
			sql = sql + "     on ppc.pers_ncorr = ddc.pers_ncorr \n ";
			sql = sql + " left outer join ciudades c \n ";
			sql = sql + "     on ddc.ciud_ccod =c.ciud_ccod \n ";
			sql = sql + " join periodos_academicos pac \n ";
			sql = sql + "     on oa.peri_ccod = pac.peri_ccod \n ";
			sql = sql + " join contratos con  \n ";
			sql = sql + "     on con.post_ncorr = p.post_ncorr \n ";
			sql = sql + " join pagare_upa pag \n ";
			sql = sql + "     on con.cont_ncorr = pag.cont_ncorr  \n ";
			sql = sql + "     and isnull(pag.opag_ccod,1) not in (2)  \n ";
			sql = sql + " join sedes ss \n ";
			sql = sql + "     on oa.sede_ccod = ss.sede_ccod \n ";
			sql = sql + " join ciudades ciu  \n ";
			sql = sql + "     on ss.ciud_ccod = ciu.ciud_ccod \n ";
			sql = sql + " join compromisos cps   \n ";
			sql = sql + "     on con.cont_ncorr=cps.comp_ndocto   \n ";
			sql = sql + "  join detalle_compromisos dc  \n ";
			sql = sql + "     on cps.comp_ndocto=dc.comp_ndocto \n ";  
			sql = sql + " 	and cps.inst_ccod=dc.inst_ccod   \n ";
			sql = sql + " 	and cps.tcom_ccod=dc.tcom_ccod    \n ";
			sql = sql + "  left outer join detalle_ingresos dii  \n ";
			sql = sql + "     on protic.documento_asociado_cuota(dc.tcom_ccod, dc.inst_ccod, dc.comp_ndocto, dc.dcom_ncompromiso, 'ting_ccod')   = dii.ting_ccod   \n ";
			sql = sql + " 	and protic.documento_asociado_cuota(dc.tcom_ccod, dc.inst_ccod, dc.comp_ndocto, dc.dcom_ncompromiso, 'ingr_ncorr') = dii.ingr_ncorr   \n ";
			sql = sql + " 	and protic.documento_asociado_cuota(dc.tcom_ccod, dc.inst_ccod, dc.comp_ndocto, dc.dcom_ncompromiso, 'ding_ndocto')= dii.ding_ndocto     \n ";
			sql = sql + "  left outer join ingresos ii  \n ";
			sql = sql + "     on dii.ingr_ncorr = ii.ingr_ncorr \n ";
			sql = sql + "  left outer join tipos_ingresos tii  \n ";
			sql = sql + "     on dii.ting_ccod =tii.ting_ccod  \n ";
			sql = sql + "  left outer join bancos bn  \n ";
			sql = sql + "     on dii.banc_ccod = bn.banc_ccod \n ";
			sql = sql + " WHERE   \n ";
			sql = sql + "  p.post_ncorr = ISNULL('" +post_ncorr+ "', '0')  \n ";
			sql = sql + "  AND ddc.tdir_ccod = 1  \n ";
			sql = sql + " AND ddp.tdir_ccod = 1  \n ";
			sql = sql + "  and isnull(dii.ting_ccod, 0) in (66) \n ";
			sql = sql + " and con.econ_ccod in (1, 2)   \n ";
			sql = sql + " and cps.tcom_ccod in (1,2)  \n ";
			sql = sql + " and dc.tcom_ccod in (1,2)   \n ";