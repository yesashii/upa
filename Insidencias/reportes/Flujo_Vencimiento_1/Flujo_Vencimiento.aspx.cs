using System;
using System.Collections;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Web;
using System.Web.SessionState;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.HtmlControls;
using CrystalDecisions.Shared;
using CrystalDecisions.CrystalReports.Engine;
namespace Flujo_Vencimiento_1
{
	/// <summary>
	/// Descripción breve de WebForm1.
	/// </summary>
	public class WebForm1 : System.Web.UI.Page
	{
		protected System.Data.OleDb.OleDbDataAdapter oleDbDataAdapter1;
		protected System.Data.OleDb.OleDbCommand oleDbSelectCommand1;
		protected System.Data.OleDb.OleDbConnection oleDbConnection1;
		protected CrystalDecisions.Web.CrystalReportViewer VerReporte;
		protected Flujo_Vencimiento_1.FlujoVencimientoDatos flujoVencimientoDatos1;

		private void ExportarPDF(ReportDocument rep) 
		{
			String ruta_exportacion;

			ruta_exportacion = Server.MapPath(System.Configuration.ConfigurationSettings.AppSettings["ruta_exportacion_pdf"]);
			//ruta_exportacion = System.Configuration.ConfigurationSettings.AppSettings["ruta_exportacion_pdf"];
			
			ExportOptions exportOpts = new ExportOptions();
			DiskFileDestinationOptions diskOpts = new DiskFileDestinationOptions();

			exportOpts = rep.ExportOptions;
			exportOpts.ExportFormatType = ExportFormatType.PortableDocFormat;

			exportOpts.ExportDestinationType = ExportDestinationType.DiskFile;
			diskOpts.DiskFileName = ruta_exportacion + Session.SessionID.ToString() + ".pdf";			
			exportOpts.DestinationOptions = diskOpts;

			rep.Export();
						
			Response.ClearContent();
			Response.ClearHeaders();
			Response.ContentType = "application/pdf";
			Response.WriteFile(diskOpts.DiskFileName.ToString());
			Response.Flush();
			Response.Close();
			System.IO.File.Delete(diskOpts.DiskFileName.ToString());
						
		}
		private void ExportarEXCEL(ReportDocument rep) 
		{
			String ruta_exportacion;

			ruta_exportacion = Server.MapPath(System.Configuration.ConfigurationSettings.AppSettings["ruta_exportacion_pdf"]);
			//ruta_exportacion = System.Configuration.ConfigurationSettings.AppSettings["ruta_exportacion_pdf"];
			
			ExportOptions exportOpts = new ExportOptions();
			DiskFileDestinationOptions diskOpts = new DiskFileDestinationOptions();

			exportOpts = rep.ExportOptions;
			exportOpts.ExportFormatType = ExportFormatType.Excel;
			exportOpts.ExportDestinationType = ExportDestinationType.DiskFile;
			diskOpts.DiskFileName = ruta_exportacion + Session.SessionID.ToString() + ".xls";	
			exportOpts.DestinationOptions = diskOpts;

			rep.Export();
						
			Response.ClearContent();
			Response.ClearHeaders();
			Response.AddHeader ("Content-Disposition", "attachment;filename=flujo_vencimiento.xls");
			Response.ContentType = "application/vnd.ms-excel";
			Response.WriteFile(diskOpts.DiskFileName.ToString());
			Response.Flush();
			Response.Close();
			System.IO.File.Delete(diskOpts.DiskFileName.ToString());
						
		}
		private string EscribirCodigo_Ant(string periodo, string fecha_inicio,
										string fecha_termino, string sede, string ano_actual)
		{
			string sql;
		    
			
			sql =  " select z.PERI_TDESC  periodo, '"+fecha_inicio+"' fecha_inicio, '"+fecha_termino+"' fecha_termino,\n";
			sql = sql + "z.CARR_TDESC,z.CARR_CCOD,z.SEDE_TDESC, TOTAL_CHEQUE_A,  TOTAL_LETRA_A,  TOTAL_CHEQUE_N,  TOTAL_LETRA_N,  \n";
			sql = sql + "  EFECTIVO_A,  EFECTIVO_N,  TOTAL_CREDITO_A,  TOTAL_BECA_A,  TOTAL_DESCUENTO_A,  TOTAL_CREDITO_N,   \n";
			sql = sql + "  TOTAL_BECA_N,  TOTAL_DESCUENTO_N,  TOTAL_MATR_CHEQUE_A,  TOTAL_MATR_LETRA_A,  TOTAL_COL_LETRA_A,   \n";
			sql = sql + "  TOTAL_COL_CHEQUE_A,  TOTAL_MATR_CHEQUE_N,  TOTAL_MATR_LETRA_N,  TOTAL_COL_LETRA_N,  \n";
			sql = sql + "  TOTAL_COL_CHEQUE_N,  TOTAL_MATR_EFECTIVO_A,  TOTAL_COL_EFECTIVO_A,  TOTAL_MATR_EFECTIVO_N,   \n";
			sql = sql + "  TOTAL_COL_EFECTIVO_N,total_credito_matr_n, total_beca_matr_n, total_descuento_matr_n,   \n";
			sql = sql + "  total_credito_col_n, total_beca_col_n,total_descuento_col_n,total_credito_matr_a, total_beca_matr_a, total_descuento_matr_a,  \n"; 
			sql = sql + "  total_credito_col_a, total_beca_col_a,total_descuento_col_a   \n";
			sql = sql + "  from    \n";
			sql = sql + "  ( \n";


			if (sede != "") 
			{
				sql = sql + "   select distinct car.CARR_TDESC,car.CARR_CCOD,ss.SEDE_TDESC,pa.PERI_TDESC     \n";
				sql = sql + "   from ofertas_academicas oo , especialidades ee, carreras car, sedes ss, periodos_academicos pa   \n";
				sql = sql + "   where oo.PERI_CCOD="+periodo;
				sql = sql + "   						and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)    \n";
				sql = sql + "   						and oo.ESPE_CCOD=ee.ESPE_CCOD    \n";
				sql = sql + "   						and ee.CARR_CCOD=car.CARR_CCOD    \n";
				sql = sql + "   						and ss.SEDE_CCOD= oo.SEDE_CCOD     \n";
				sql = sql + "   						and oo.PERI_CCOD=pa.PERI_CCOD    \n";

			}
			else 
			{
				sql = sql + "     select distinct car.CARR_TDESC,car.CARR_CCOD,'TODAS' SEDE_TDESC,pa.PERI_TDESC    ";
				sql = sql + "     from ofertas_academicas oo , especialidades ee, carreras car,periodos_academicos pa      ";
				sql = sql + "     where oo.PERI_CCOD="+periodo;
				sql = sql + "     						and oo.SEDE_CCOD=nvl('',oo.SEDE_CCOD)      ";
				sql = sql + "     						and oo.ESPE_CCOD=ee.ESPE_CCOD      ";
				sql = sql + "     						and ee.CARR_CCOD=car.CARR_CCOD      ";
				sql = sql + "   						and oo.PERI_CCOD=pa.PERI_CCOD    \n";
			}

			sql = sql + " ) z, \n";
			sql = sql + " (   \n";
			sql = sql + " select CARR_TDESC,CARR_CCOD,sum(CHEQUE) total_cheque_a,sum(LETRA) total_letra_a    \n";
			sql = sql + "  	from (   \n";
			sql = sql + "  			   select DECODE( a.TING_CCOD,3,a.valor_efectivo) CHEQUE,   \n";
			sql = sql + "  			   		  DECODE( a.TING_CCOD,4,a.valor_efectivo) LETRA,   \n";
			sql = sql + "  			    	  a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TING_CCOD    \n";
			sql = sql + "  			   from (   \n";
			sql = sql + "  			   		  select sum(dii.DING_MDOCTO) valor_efectivo,car.CARR_CCOD, car.CARR_TDESC,   \n";
			sql = sql + "  					  		  aa.PERS_NCORR,dii.TING_CCOD   \n";
			sql = sql + "  						from alumnos aa, contratos cc, compromisos com,    \n";
			sql = sql + "  						detalle_compromisos dc, abonos ab,   \n";
			sql = sql + "  						ingresos ii,detalle_ingresos dii,   \n";
			sql = sql + "  						ofertas_academicas oo , especialidades ee, carreras car   \n";
			sql = sql + "  						where aa.emat_ccod<>9   \n";
			sql = sql + "  						and cc.CONT_NCORR=com.COMP_NDOCTO   \n";
			sql = sql + "  						and com.TCOM_CCOD=dc.TCOM_CCOD   \n";
			sql = sql + "  						and com.INST_CCOD=dc.INST_CCOD   \n";
			sql = sql + "  						and oo.PERI_CCOD=160   \n";
			sql = sql + "  						and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)   \n";
			sql = sql + "  						and aa.OFER_NCORR=oo.OFER_NCORR   \n";
			sql = sql + "  						and oo.ESPE_CCOD=ee.ESPE_CCOD   \n";
			sql = sql + "  						and ee.CARR_CCOD=car.CARR_CCOD   \n";
			sql = sql + "  						and cc.ECON_CCOD=1   \n";
			sql = sql + "  						and aa.MATR_NCORR=cc.MATR_NCORR   \n";
			sql = sql + "  						and com.ECOM_CCOD=1   \n";
			sql = sql + "  						and com.TCOM_CCOD in (1,2)   \n";
			sql = sql + "  						and com.COMP_NDOCTO=dc.COMP_NDOCTO   \n";
			sql = sql + "  						and dc.TCOM_CCOD=ab.TCOM_CCOD   \n";
			sql = sql + "  						and dc.INST_CCOD=ab.INST_CCOD   \n";
			sql = sql + "  						and dc.COMP_NDOCTO=ab.COMP_NDOCTO   \n";
			sql = sql + "  						and dc.DCOM_NCOMPROMISO=ab.DCOM_NCOMPROMISO   \n";
			sql = sql + "  						and ii.EING_CCOD=4	   \n";
			sql = sql + "  						and ii.INGR_MEFECTIVO=0   \n";
			sql = sql + "  						and ab.INGR_NCORR=ii.INGR_NCORR   \n";
			sql = sql + "  						and ii.INGR_NCORR=dii.INGR_NCORR   \n";
			sql = sql + "  						and dii.DING_NCORRELATIVO=1   \n";
			sql = sql + "  						and dii.DING_BPACTA_CUOTA='S'   \n";
			sql = sql + "  						and trunc(dii.DING_FDOCTO) between nvl(to_date('"+fecha_inicio+"','DD/MM/YYYY'),dii.DING_FDOCTO)    \n";
			sql = sql + "  						and nvl(to_date('"+fecha_termino+"','DD/MM/YYYY'),dii.DING_FDOCTO)   \n";
			sql = sql + "  						group by car.CARR_CCOD, car.CARR_TDESC,aa.PERS_NCORR,dii.TING_CCOD   \n";
			sql = sql + "  						) a    \n";
			sql = sql + "  					group by  a.valor_efectivo, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TING_CCOD    \n";
			sql = sql + "  					having ano_ingreso_carrera(a.PERS_NCORR,a.CARR_CCOD)< " +ano_actual+"   \n";
			sql = sql + "  					)    \n";
			sql = sql + "  					group by CARR_CCOD,CARR_TDESC   \n";
			sql = sql + " )a,   \n";
			sql = sql + "  	(  \n";
			sql = sql + " select CARR_TDESC,CARR_CCOD,sum(CHEQUE) total_cheque_n,sum(LETRA) total_letra_n    \n";
			sql = sql + "  	from (   \n";
			sql = sql + "  			   select DECODE( a.TING_CCOD,3,a.valor_efectivo) CHEQUE,   \n";
			sql = sql + "  			   		  DECODE( a.TING_CCOD,4,a.valor_efectivo) LETRA,   \n";
			sql = sql + "  			    	  a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TING_CCOD    \n";
			sql = sql + "  			   from (   \n";
			sql = sql + "  			   		  select sum(dii.DING_MDOCTO) valor_efectivo,car.CARR_CCOD, car.CARR_TDESC,   \n";
			sql = sql + "  					  		  aa.PERS_NCORR,dii.TING_CCOD   \n";
			sql = sql + "  						from alumnos aa, contratos cc, compromisos com,    \n";
			sql = sql + "  						detalle_compromisos dc, abonos ab,   \n";
			sql = sql + "  						ingresos ii,detalle_ingresos dii,   \n";
			sql = sql + "  						ofertas_academicas oo , especialidades ee, carreras car   \n";
			sql = sql + "  						where aa.emat_ccod<>9   \n";
			sql = sql + "  						and cc.CONT_NCORR=com.COMP_NDOCTO   \n";
			sql = sql + "  						and com.TCOM_CCOD=dc.TCOM_CCOD   \n";
			sql = sql + "  						and com.INST_CCOD=dc.INST_CCOD   \n";
			sql = sql + "  						and oo.PERI_CCOD="+periodo;
			sql = sql + "  						and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)   \n";
			sql = sql + "  						and aa.OFER_NCORR=oo.OFER_NCORR   \n";
			sql = sql + "  						and oo.ESPE_CCOD=ee.ESPE_CCOD   \n";
			sql = sql + "  						and ee.CARR_CCOD=car.CARR_CCOD   \n";
			sql = sql + "  						and cc.ECON_CCOD=1   \n";
			sql = sql + "  						and aa.MATR_NCORR=cc.MATR_NCORR   \n";
			sql = sql + "  						and com.ECOM_CCOD=1   \n";
			sql = sql + "  						and com.TCOM_CCOD in (1,2)   \n";
			sql = sql + "  						and com.COMP_NDOCTO=dc.COMP_NDOCTO   \n";
			sql = sql + "  						and dc.TCOM_CCOD=ab.TCOM_CCOD   \n";
			sql = sql + "  						and dc.INST_CCOD=ab.INST_CCOD   \n";
			sql = sql + "  						and dc.COMP_NDOCTO=ab.COMP_NDOCTO   \n";
			sql = sql + "  						and dc.DCOM_NCOMPROMISO=ab.DCOM_NCOMPROMISO   \n";
			sql = sql + "  						and ii.EING_CCOD=4		   \n";
			sql = sql + "  						and ii.INGR_MEFECTIVO=0   \n";
			sql = sql + "  						and ab.INGR_NCORR=ii.INGR_NCORR   \n";
			sql = sql + "  						and ii.INGR_NCORR=dii.INGR_NCORR   \n";
			sql = sql + "  						and dii.DING_NCORRELATIVO=1   \n";
			sql = sql + "  						and dii.DING_BPACTA_CUOTA='S'   \n";
			sql = sql + "  						and trunc(dii.DING_FDOCTO) between nvl(to_date('"+fecha_inicio+"','DD/MM/YYYY'),dii.DING_FDOCTO)    \n";
			sql = sql + "  						and nvl(to_date('"+fecha_termino+"','DD/MM/YYYY'),dii.DING_FDOCTO)   \n";
			sql = sql + "  						group by car.CARR_CCOD, car.CARR_TDESC,aa.PERS_NCORR,dii.TING_CCOD   \n";
			sql = sql + "  						) a    \n";
			sql = sql + "  					group by  a.valor_efectivo, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TING_CCOD    \n";
			sql = sql + "  					having ano_ingreso_carrera(a.PERS_NCORR,a.CARR_CCOD)= " +ano_actual+"   \n";
			sql = sql + "  					)    \n";
			sql = sql + "  					group by CARR_CCOD,CARR_TDESC   \n";
			sql = sql + " )b,   \n";
			sql = sql + "  	(  \n";
			sql = sql + "  	select CARR_TDESC,sum(total_alumno) efectivo_a,CARR_CCOD  from (   \n";
			sql = sql + "  			   select a.valor_efectivo as total_alumno, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR from (   \n";
			sql = sql + "  			   		  select sum(ii.INGR_MEFECTIVO) valor_efectivo,car.CARR_CCOD, car.CARR_TDESC, aa.PERS_NCORR   \n";
			sql = sql + "  						from alumnos aa, contratos cc, compromisos com,    \n";
			sql = sql + "  						detalle_compromisos dc, abonos ab,   \n";
			sql = sql + "  						ingresos ii,   \n";
			sql = sql + "  						ofertas_academicas oo , especialidades ee, carreras car   \n";
			sql = sql + "  						where aa.emat_ccod<>9   \n";
			sql = sql + "  						and cc.CONT_NCORR=com.COMP_NDOCTO   \n";
			sql = sql + "  						and com.TCOM_CCOD=dc.TCOM_CCOD   \n";
			sql = sql + "  						and com.INST_CCOD=dc.INST_CCOD   \n";
			sql = sql + "  						and oo.PERI_CCOD="+periodo;
			sql = sql + "  						and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)   \n";
			sql = sql + "  						and aa.OFER_NCORR=oo.OFER_NCORR   \n";
			sql = sql + "  						and oo.ESPE_CCOD=ee.ESPE_CCOD   \n";
			sql = sql + "  						and ee.CARR_CCOD=car.CARR_CCOD   \n";
			sql = sql + "  						and cc.ECON_CCOD=1   \n";
			sql = sql + "  						and aa.MATR_NCORR=cc.MATR_NCORR   \n";
			sql = sql + "  						and com.ECOM_CCOD=1   \n";
			sql = sql + "  						and com.TCOM_CCOD in (1,2)   \n";
			sql = sql + "  						and com.COMP_NDOCTO=dc.COMP_NDOCTO   \n";
			sql = sql + "  						and dc.TCOM_CCOD=ab.TCOM_CCOD   \n";
			sql = sql + "  						and dc.INST_CCOD=ab.INST_CCOD   \n";
			sql = sql + "  						and dc.COMP_NDOCTO=ab.COMP_NDOCTO   \n";
			sql = sql + "  						and dc.DCOM_NCOMPROMISO=ab.DCOM_NCOMPROMISO   \n";
			sql = sql + "  						and trunc(dc.DCOM_FCOMPROMISO) between nvl(to_date('"+fecha_inicio+"','DD/MM/YYYY'),dc.DCOM_FCOMPROMISO)    \n";
			sql = sql + "  						and nvl(to_date('"+fecha_termino+"','DD/MM/YYYY'),dc.DCOM_FCOMPROMISO)   \n";
			sql = sql + "  						and ii.EING_CCOD=1		   \n";
			sql = sql + "  						and ii.INGR_MEFECTIVO <>0   \n";
			sql = sql + "  						and ab.INGR_NCORR=ii.INGR_NCORR   \n";
			sql = sql + "  						group by car.CARR_CCOD, car.CARR_TDESC,aa.PERS_NCORR   \n";
			sql = sql + "  						) a    \n";
			sql = sql + "  					group by  a.valor_efectivo, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR    \n";
			sql = sql + "  					having ano_ingreso_carrera(a.PERS_NCORR, a.CARR_CCOD)< " +ano_actual+"   \n";
			sql = sql + "  					)    \n";
			sql = sql + "  					group by CARR_CCOD,CARR_TDESC   \n";
			sql = sql + "  	)c,   \n";
			sql = sql + "  	(   \n";
			sql = sql + "  	select CARR_TDESC,sum(total_alumno) efectivo_n, CARR_CCOD from (   \n";
			sql = sql + "  			   select a.valor_efectivo as total_alumno, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR from (   \n";
			sql = sql + "  			   		  select sum(ii.INGR_MEFECTIVO) valor_efectivo,car.CARR_CCOD, car.CARR_TDESC, aa.PERS_NCORR   \n";
			sql = sql + "  						from alumnos aa, contratos cc, compromisos com,    \n";
			sql = sql + "  						detalle_compromisos dc, abonos ab,   \n";
			sql = sql + "  						ingresos ii,   \n";
			sql = sql + "  						ofertas_academicas oo , especialidades ee, carreras car   \n";
			sql = sql + "  						where aa.emat_ccod<>9   \n";
			sql = sql + "  						and cc.CONT_NCORR=com.COMP_NDOCTO   \n";
			sql = sql + "  						and com.TCOM_CCOD=dc.TCOM_CCOD   \n";
			sql = sql + "  						and com.INST_CCOD=dc.INST_CCOD   \n";
			sql = sql + "  						and oo.PERI_CCOD="+periodo;
			sql = sql + "  						and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)   \n";
			sql = sql + "  						and aa.OFER_NCORR=oo.OFER_NCORR   \n";
			sql = sql + "  						and oo.ESPE_CCOD=ee.ESPE_CCOD   \n";
			sql = sql + "  						and ee.CARR_CCOD=car.CARR_CCOD   \n";
			sql = sql + "  						and cc.ECON_CCOD=1   \n";
			sql = sql + "  						and aa.MATR_NCORR=cc.MATR_NCORR   \n";
			sql = sql + "  						and com.ECOM_CCOD=1   \n";
			sql = sql + "  						and com.TCOM_CCOD in (1,2)   \n";
			sql = sql + "  						and com.COMP_NDOCTO=dc.COMP_NDOCTO   \n";
			sql = sql + "  						and dc.TCOM_CCOD=ab.TCOM_CCOD   \n";
			sql = sql + "  						and dc.INST_CCOD=ab.INST_CCOD   \n";
			sql = sql + "  						and dc.COMP_NDOCTO=ab.COMP_NDOCTO   \n";
			sql = sql + "  						and dc.DCOM_NCOMPROMISO=ab.DCOM_NCOMPROMISO   \n";
			sql = sql + "  						and trunc(dc.DCOM_FCOMPROMISO) between nvl(to_date('"+fecha_inicio+"','DD/MM/YYYY'),dc.DCOM_FCOMPROMISO)    \n";
			sql = sql + "  						and nvl(to_date('"+fecha_termino+"','DD/MM/YYYY'),dc.DCOM_FCOMPROMISO)   \n";
			sql = sql + "  						and ii.EING_CCOD=1		   \n";
			sql = sql + "  						and ii.INGR_MEFECTIVO <>0   \n";
			sql = sql + "  						and ab.INGR_NCORR=ii.INGR_NCORR   \n";
			sql = sql + "  						group by car.CARR_CCOD, car.CARR_TDESC,aa.PERS_NCORR   \n";
			sql = sql + "  						) a    \n";
			sql = sql + "  					group by  a.valor_efectivo, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR    \n";
			sql = sql + "  					having ano_ingreso_carrera(a.PERS_NCORR, a.CARR_CCOD)= " +ano_actual+"   \n";
			sql = sql + "  					)    \n";
			sql = sql + "  					group by CARR_CCOD,CARR_TDESC   \n";
			sql = sql + "  	)d,   \n";
			sql = sql + "  	(  \n";
			sql = sql + "  	select CARR_TDESC,CARR_CCOD,sum(credito) total_credito_a, sum(beca) total_beca_a, sum(descuento) total_descuento_a    \n";
			sql = sql + "  			   from (   \n";
			sql = sql + "  			   select DECODE(a.TBEN_CCOD,1,a.valor_efectivo) CREDITO,   \n";
			sql = sql + "  		       		  DECODE(a.TBEN_CCOD,2,a.valor_efectivo) BECA,   \n";
			sql = sql + "  			   		  DECODE(a.TBEN_CCOD,3,a.valor_efectivo) DESCUENTO ,    \n";
			sql = sql + "  					  a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TBEN_CCOD    \n";
			sql = sql + "  					  from (   \n";
			sql = sql + "  			   		  select sum(DECODE(be.MONE_CCOD,2,   \n";
			sql = sql + "  					  		 			round(be.BENE_MMONTO_ACUM_COLEGIATURA*ufom.UFOM_MVALOR),1,   \n";
			sql = sql + "  										be.BENE_MMONTO_ACUM_COLEGIATURA))+   \n";
			sql = sql + "  							sum(DECODE(be.MONE_CCOD,2,   \n";
			sql = sql + "  									   round(be.BENE_MMONTO_ACUM_MATRICULA*ufom.UFOM_MVALOR),1,   \n";
			sql = sql + "  									   be.BENE_MMONTO_ACUM_MATRICULA))  		  		      \n";
			sql = sql + "  						    valor_efectivo,car.CARR_CCOD, car.CARR_TDESC, aa.PERS_NCORR,tb.TBEN_CCOD   \n";
			sql = sql + "  							from alumnos aa, contratos cc,    \n";
			sql = sql + "  							beneficios be,stipos_descuentos std, tipos_beneficios tb,    \n";
			sql = sql + "  							ofertas_academicas oo , especialidades ee, carreras car, uf ufom   \n";
			sql = sql + "  							where aa.emat_ccod<>9   \n";
			sql = sql + "  							and oo.PERI_CCOD="+periodo;
			sql = sql + "  							and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)   \n";
			sql = sql + "  							and aa.OFER_NCORR=oo.OFER_NCORR   \n";
			sql = sql + "  							and oo.ESPE_CCOD=ee.ESPE_CCOD   \n";
			sql = sql + "  							and ee.CARR_CCOD=car.CARR_CCOD   \n";
			sql = sql + "  							and cc.ECON_CCOD=1   \n";
			sql = sql + "  							and aa.MATR_NCORR=cc.MATR_NCORR   \n";
			sql = sql + "  							and be.EBEN_CCOD=1   \n";
			sql = sql + "  							and be.CONT_NCORR=cc.CONT_NCORR   \n";
			sql = sql + "  							and trunc(be.BENE_FBENEFICIO) between nvl(to_date('"+fecha_inicio+"','DD/MM/YYYY'),be.BENE_FBENEFICIO)   \n";
			sql = sql + "  							and nvl(to_date('"+fecha_termino+"','DD/MM/YYYY'),be.BENE_FBENEFICIO)   \n";
			sql = sql + "  							and be.STDE_CCOD =std.STDE_CCOD   \n";
			sql = sql + "  							and std.TBEN_CCOD=tb.TBEN_CCOD   \n";
			sql = sql + "  							and be.UFOM_NCORR=ufom.UFOM_NCORR (+)   \n";
			sql = sql + "  							group by car.CARR_CCOD, car.CARR_TDESC,aa.PERS_NCORR,tb.TBEN_CCOD   \n";
			sql = sql + "  						) a    \n";
			sql = sql + "  					group by  a.valor_efectivo, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR, a.TBEN_CCOD   \n";
			sql = sql + "  					having ano_ingreso_carrera(a.PERS_NCORR,a.CARR_CCOD)< " +ano_actual+"   \n";
			sql = sql + "  					)    \n";
			sql = sql + "  					group by CARR_CCOD,CARR_TDESC   \n";
			sql = sql + "  	) e,		   \n";
			sql = sql + "  	(  \n";
			sql = sql + "  	select CARR_TDESC,CARR_CCOD,sum(credito) total_credito_n, sum(beca) total_beca_n, sum(descuento) total_descuento_n   \n";
			sql = sql + "  			   from (   \n";
			sql = sql + "  			   select DECODE(a.TBEN_CCOD,1,a.valor_efectivo) CREDITO,   \n";
			sql = sql + "  		       		  DECODE(a.TBEN_CCOD,2,a.valor_efectivo) BECA,   \n";
			sql = sql + "  			   		  DECODE(a.TBEN_CCOD,3,a.valor_efectivo) DESCUENTO ,    \n";
			sql = sql + "  					  a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TBEN_CCOD    \n";
			sql = sql + "  					  from (   \n";
			sql = sql + "  			   		  select sum(DECODE(be.MONE_CCOD,2,   \n";
			sql = sql + "  					  		 			round(be.BENE_MMONTO_ACUM_COLEGIATURA*ufom.UFOM_MVALOR),1,   \n";
			sql = sql + "  										be.BENE_MMONTO_ACUM_COLEGIATURA))+   \n";
			sql = sql + "  							sum(DECODE(be.MONE_CCOD,2,   \n";
			sql = sql + "  									   round(be.BENE_MMONTO_ACUM_MATRICULA*ufom.UFOM_MVALOR),1,   \n";
			sql = sql + "  									   be.BENE_MMONTO_ACUM_MATRICULA))  		  		      \n";
			sql = sql + "  						    valor_efectivo,car.CARR_CCOD, car.CARR_TDESC, aa.PERS_NCORR,tb.TBEN_CCOD   \n";
			sql = sql + "  							from alumnos aa, contratos cc,    \n";
			sql = sql + "  							beneficios be,stipos_descuentos std, tipos_beneficios tb,    \n";
			sql = sql + "  							ofertas_academicas oo , especialidades ee, carreras car, uf ufom   \n";
			sql = sql + "  							where aa.emat_ccod<>9   \n";
			sql = sql + "  							and oo.PERI_CCOD="+periodo;
			sql = sql + "  							and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)   \n";
			sql = sql + "  							and aa.OFER_NCORR=oo.OFER_NCORR   \n";
			sql = sql + "  							and oo.ESPE_CCOD=ee.ESPE_CCOD   \n";
			sql = sql + "  							and ee.CARR_CCOD=car.CARR_CCOD   \n";
			sql = sql + "  							and cc.ECON_CCOD=1   \n";
			sql = sql + "  							and aa.MATR_NCORR=cc.MATR_NCORR   \n";
			sql = sql + "  							and be.EBEN_CCOD=1   \n";
			sql = sql + "  							and be.CONT_NCORR=cc.CONT_NCORR   \n";
			sql = sql + "  							and trunc(be.BENE_FBENEFICIO) between nvl(to_date('"+fecha_inicio+"','DD/MM/YYYY'),be.BENE_FBENEFICIO)   \n";
			sql = sql + "  							and nvl(to_date('"+fecha_termino+"','DD/MM/YYYY'),be.BENE_FBENEFICIO)   \n";
			sql = sql + "  							and be.STDE_CCOD =std.STDE_CCOD   \n";
			sql = sql + "  							and std.TBEN_CCOD=tb.TBEN_CCOD   \n";
			sql = sql + "  							and be.UFOM_NCORR=ufom.UFOM_NCORR (+)   \n";
			sql = sql + "  							group by car.CARR_CCOD, car.CARR_TDESC,aa.PERS_NCORR,tb.TBEN_CCOD   \n";
			sql = sql + "  						) a    \n";
			sql = sql + "  					group by  a.valor_efectivo, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR, a.TBEN_CCOD   \n";
			sql = sql + "  					having ano_ingreso_carrera(a.PERS_NCORR,a.CARR_CCOD)= " +ano_actual+"   \n";
			sql = sql + "  					)    \n";
			sql = sql + "  					group by CARR_CCOD,CARR_TDESC   \n";
			sql = sql + "  ) f,	   \n";
			sql = sql + "  	(  \n";
			sql = sql + "  	select CARR_TDESC,CARR_CCOD,   \n";
			sql = sql + "  		sum(MATRICULA_CHEQUE) total_matr_cheque_a,   \n";
			sql = sql + "  		sum(MATRICULA_LETRA) total_matr_letra_a,   \n";
			sql = sql + "  		sum(COLEGIATURA_CHEQUE) total_col_cheque_a,sum(COLEGIATURA_LETRA) total_col_letra_a    \n";
			sql = sql + "  		from (   \n";
			sql = sql + "  			   select CASE WHEN (a.TCOM_CCOD=1 and a.TING_CCOD=3) THEN a.valor_efectivo end MATRICULA_CHEQUE,   \n";
			sql = sql + "  			   		  CASE WHEN (a.TCOM_CCOD=1 and a.TING_CCOD=4) THEN a.valor_efectivo end MATRICULA_LETRA,   \n";
			sql = sql + "  					  CASE WHEN (a.TCOM_CCOD=2 and a.TING_CCOD=3) THEN a.valor_efectivo end COLEGIATURA_CHEQUE,   \n";
			sql = sql + "  					  CASE WHEN (a.TCOM_CCOD=2 and a.TING_CCOD=4) THEN a.valor_efectivo end COLEGIATURA_LETRA,   \n";
			sql = sql + "  			   		  a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TCOM_CCOD,a.TING_CCOD   \n";
			sql = sql + "  			   from (   \n";
			sql = sql + "  			   		  select sum(dii.DING_MDOCTO) valor_efectivo,car.CARR_CCOD, car.CARR_TDESC,    \n";
			sql = sql + "  					  aa.PERS_NCORR,com.TCOM_CCOD,dii.TING_CCOD   \n";
			sql = sql + "  						from alumnos aa, contratos cc, compromisos com,    \n";
			sql = sql + "  						detalle_compromisos dc, abonos ab,   \n";
			sql = sql + "  						ingresos ii,detalle_ingresos dii,   \n";
			sql = sql + "  						ofertas_academicas oo , especialidades ee, carreras car   \n";
			sql = sql + "  						where aa.emat_ccod<>9   \n";
			sql = sql + "  						and cc.CONT_NCORR=com.COMP_NDOCTO   \n";
			sql = sql + "  						and com.TCOM_CCOD=dc.TCOM_CCOD   \n";
			sql = sql + "  						and com.INST_CCOD=dc.INST_CCOD   \n";
			sql = sql + "  						and oo.PERI_CCOD="+periodo;
			sql = sql + "  						and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)   \n";
			sql = sql + "  						and aa.OFER_NCORR=oo.OFER_NCORR   \n";
			sql = sql + "  						and oo.ESPE_CCOD=ee.ESPE_CCOD   \n";
			sql = sql + "  						and ee.CARR_CCOD=car.CARR_CCOD   \n";
			sql = sql + "  						and cc.ECON_CCOD=1   \n";
			sql = sql + "  						and aa.MATR_NCORR=cc.MATR_NCORR   \n";
			sql = sql + "  						and com.ECOM_CCOD=1   \n";
			sql = sql + "  						and com.COMP_NDOCTO=dc.COMP_NDOCTO   \n";
			sql = sql + "  						and dc.TCOM_CCOD=ab.TCOM_CCOD   \n";
			sql = sql + "  						and dc.INST_CCOD=ab.INST_CCOD   \n";
			sql = sql + "  						and dc.COMP_NDOCTO=ab.COMP_NDOCTO   \n";
			sql = sql + "  						and dc.DCOM_NCOMPROMISO=ab.DCOM_NCOMPROMISO   \n";
			sql = sql + "  						and ii.EING_CCOD=4	   \n";
			sql = sql + "  						and ii.INGR_MEFECTIVO=0   \n";
			sql = sql + "  						and ab.INGR_NCORR=ii.INGR_NCORR   \n";
			sql = sql + "  						and ii.INGR_NCORR=dii.INGR_NCORR   \n";
			sql = sql + "  						and dii.DING_NCORRELATIVO=1   \n";
			sql = sql + "  						and dii.DING_BPACTA_CUOTA='S'   \n";
			sql = sql + "  						and trunc(dii.DING_FDOCTO) between nvl(to_date('"+fecha_inicio+"','DD/MM/YYYY'),dii.DING_FDOCTO)   \n";
			sql = sql + "  						and nvl(to_date('"+fecha_termino+"','DD/MM/YYYY'),dii.DING_FDOCTO)   \n";
			sql = sql + "  						group by car.CARR_CCOD, car.CARR_TDESC,aa.PERS_NCORR,com.TCOM_CCOD,dii.TING_CCOD   \n";
			sql = sql + "  						) a    \n";
			sql = sql + "  					group by  a.valor_efectivo, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TCOM_CCOD,a.TING_CCOD    \n";
			sql = sql + "  					having ano_ingreso_carrera(a.PERS_NCORR,a.CARR_CCOD)< " +ano_actual+"   \n";
			sql = sql + "  					)    \n";
			sql = sql + "  					group by CARR_CCOD,CARR_TDESC   \n";
			sql = sql + "  	) g,   \n";
			sql = sql + "  	(  \n";
			sql = sql + "  	select CARR_TDESC,CARR_CCOD,   \n";
			sql = sql + "  		sum(MATRICULA_CHEQUE) total_matr_cheque_n,   \n";
			sql = sql + "  		sum(MATRICULA_LETRA) total_matr_letra_n,   \n";
			sql = sql + "  		sum(COLEGIATURA_CHEQUE) total_col_cheque_n,sum(COLEGIATURA_LETRA) total_col_letra_n    \n";
			sql = sql + "  		from (   \n";
			sql = sql + "  			   select CASE WHEN (a.TCOM_CCOD=1 and a.TING_CCOD=3) THEN a.valor_efectivo end MATRICULA_CHEQUE,   \n";
			sql = sql + "  			   		  CASE WHEN (a.TCOM_CCOD=1 and a.TING_CCOD=4) THEN a.valor_efectivo end MATRICULA_LETRA,   \n";
			sql = sql + "  					  CASE WHEN (a.TCOM_CCOD=2 and a.TING_CCOD=3) THEN a.valor_efectivo end COLEGIATURA_CHEQUE,   \n";
			sql = sql + "  					  CASE WHEN (a.TCOM_CCOD=2 and a.TING_CCOD=4) THEN a.valor_efectivo end COLEGIATURA_LETRA,   \n";
			sql = sql + "  			   		  a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TCOM_CCOD,a.TING_CCOD   \n";
			sql = sql + "  			   from (   \n";
			sql = sql + "  			   		  select sum(dii.DING_MDOCTO) valor_efectivo,car.CARR_CCOD, car.CARR_TDESC,    \n";
			sql = sql + "  					  aa.PERS_NCORR,com.TCOM_CCOD,dii.TING_CCOD   \n";
			sql = sql + "  						from alumnos aa, contratos cc, compromisos com,    \n";
			sql = sql + "  						detalle_compromisos dc, abonos ab,   \n";
			sql = sql + "  						ingresos ii,detalle_ingresos dii,   \n";
			sql = sql + "  						ofertas_academicas oo , especialidades ee, carreras car   \n";
			sql = sql + "  						where aa.emat_ccod<>9   \n";
			sql = sql + "  						and cc.CONT_NCORR=com.COMP_NDOCTO   \n";
			sql = sql + "  						and com.TCOM_CCOD=dc.TCOM_CCOD   \n";
			sql = sql + "  						and com.INST_CCOD=dc.INST_CCOD   \n";
			sql = sql + "  						and oo.PERI_CCOD="+periodo;
			sql = sql + "  						and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)   \n";
			sql = sql + "  						and aa.OFER_NCORR=oo.OFER_NCORR   \n";
			sql = sql + "  						and oo.ESPE_CCOD=ee.ESPE_CCOD   \n";
			sql = sql + "  						and ee.CARR_CCOD=car.CARR_CCOD   \n";
			sql = sql + "  						and cc.ECON_CCOD=1   \n";
			sql = sql + "  						and aa.MATR_NCORR=cc.MATR_NCORR   \n";
			sql = sql + "  						and com.ECOM_CCOD=1   \n";
			sql = sql + "  						and com.COMP_NDOCTO=dc.COMP_NDOCTO   \n";
			sql = sql + "  						and dc.TCOM_CCOD=ab.TCOM_CCOD   \n";
			sql = sql + "  						and dc.INST_CCOD=ab.INST_CCOD   \n";
			sql = sql + "  						and dc.COMP_NDOCTO=ab.COMP_NDOCTO   \n";
			sql = sql + "  						and dc.DCOM_NCOMPROMISO=ab.DCOM_NCOMPROMISO   \n";
			sql = sql + "  						and ii.EING_CCOD=4	   \n";
			sql = sql + "  						and ii.INGR_MEFECTIVO=0   \n";
			sql = sql + "  						and ab.INGR_NCORR=ii.INGR_NCORR   \n";
			sql = sql + "  						and ii.INGR_NCORR=dii.INGR_NCORR   \n";
			sql = sql + "  						and dii.DING_NCORRELATIVO=1   \n";
			sql = sql + "  						and dii.DING_BPACTA_CUOTA='S'   \n";
			sql = sql + "  						and trunc(dii.DING_FDOCTO) between nvl(to_date('"+fecha_inicio+"','DD/MM/YYYY'),dii.DING_FDOCTO)   \n";
			sql = sql + "  						and nvl(to_date('"+fecha_termino+"','DD/MM/YYYY'),dii.DING_FDOCTO)   \n";
			sql = sql + "  						group by car.CARR_CCOD, car.CARR_TDESC,aa.PERS_NCORR,com.TCOM_CCOD,dii.TING_CCOD   \n";
			sql = sql + "  						) a    \n";
			sql = sql + "  					group by  a.valor_efectivo, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TCOM_CCOD,a.TING_CCOD    \n";
			sql = sql + "  					having ano_ingreso_carrera(a.PERS_NCORR,a.CARR_CCOD)= " +ano_actual+"   \n";
			sql = sql + "  					)    \n";
			sql = sql + "  					group by CARR_CCOD,CARR_TDESC   \n";
			sql = sql + "  	) h,   \n";
			sql = sql + "  (   \n";
			sql = sql + "  select  CARR_TDESC,CARR_CCOD,sum(MATRICULA_EFECTIVO) total_matr_efectivo_a,sum(COLEGIATURA_EFECTIVO)total_col_efectivo_a from (   \n";
			sql = sql + "  		   select DECODE (a.TCOM_CCOD,1,a.valor_efectivo) MATRICULA_EFECTIVO,   \n";
			sql = sql + "  		   		  DECODE (a.TCOM_CCOD,2,a.valor_efectivo) COLEGIATURA_EFECTIVO,   \n";
			sql = sql + "  		   		   a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TCOM_CCOD   \n";
			sql = sql + "  		    from (   \n";
			sql = sql + "  		   		  select sum(ii.INGR_MEFECTIVO) valor_efectivo,car.CARR_CCOD,   \n";
			sql = sql + "  				   car.CARR_TDESC, aa.PERS_NCORR,com.TCOM_CCOD   \n";
			sql = sql + "  					from alumnos aa, contratos cc, compromisos com,    \n";
			sql = sql + "  					detalle_compromisos dc, abonos ab,   \n";
			sql = sql + "  					ingresos ii,   \n";
			sql = sql + "  					ofertas_academicas oo , especialidades ee, carreras car   \n";
			sql = sql + "  					where aa.emat_ccod<>9   \n";
			sql = sql + "  					and cc.CONT_NCORR=com.COMP_NDOCTO   \n";
			sql = sql + "  					and com.TCOM_CCOD=dc.TCOM_CCOD   \n";
			sql = sql + "  					and com.INST_CCOD=dc.INST_CCOD   \n";
			sql = sql + "  					and oo.PERI_CCOD="+periodo;
			sql = sql + "  					and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)   \n";
			sql = sql + "  					and aa.OFER_NCORR=oo.OFER_NCORR   \n";
			sql = sql + "  					and oo.ESPE_CCOD=ee.ESPE_CCOD   \n";
			sql = sql + "  					and ee.CARR_CCOD=car.CARR_CCOD   \n";
			sql = sql + "  					and cc.ECON_CCOD=1   \n";
			sql = sql + "  					and aa.MATR_NCORR=cc.MATR_NCORR   \n";
			sql = sql + "  					and com.ECOM_CCOD=1   \n";
			sql = sql + "  					and com.COMP_NDOCTO=dc.COMP_NDOCTO   \n";
			sql = sql + "  					and dc.TCOM_CCOD=ab.TCOM_CCOD   \n";
			sql = sql + "  					and dc.INST_CCOD=ab.INST_CCOD   \n";
			sql = sql + "  					and dc.COMP_NDOCTO=ab.COMP_NDOCTO   \n";
			sql = sql + "  					and dc.DCOM_NCOMPROMISO=ab.DCOM_NCOMPROMISO   \n";
			sql = sql + "  					and trunc(dc.DCOM_FCOMPROMISO) between nvl(to_date('"+fecha_inicio+"','DD/MM/YYYY'),dc.DCOM_FCOMPROMISO)    \n";
			sql = sql + "  					and nvl(to_date('"+fecha_termino+"','DD/MM/YYYY'),dc.DCOM_FCOMPROMISO)   \n";
			sql = sql + "  					and ii.EING_CCOD=1		   \n";
			sql = sql + "  					and ii.INGR_MEFECTIVO <>0   \n";
			sql = sql + "  					and ab.INGR_NCORR=ii.INGR_NCORR   \n";
			sql = sql + "  					group by car.CARR_CCOD, car.CARR_TDESC,aa.PERS_NCORR,com.TCOM_CCOD   \n";
			sql = sql + "  					) a    \n";
			sql = sql + "  				group by  a.valor_efectivo, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TCOM_CCOD    \n";
			sql = sql + "  				having ano_ingreso_carrera(a.PERS_NCORR,a.CARR_CCOD)< " +ano_actual+"   \n";
			sql = sql + "  				)    \n";
			sql = sql + "  				group by CARR_CCOD,CARR_TDESC	   \n";
			sql = sql + "  )i,    \n";
			sql = sql + "  (  \n";
			sql = sql + "  select  CARR_TDESC,CARR_CCOD,sum(MATRICULA_EFECTIVO) total_matr_efectivo_n,sum(COLEGIATURA_EFECTIVO)total_col_efectivo_n   \n";
			sql = sql + "   from (   \n";
			sql = sql + "  		   select DECODE (a.TCOM_CCOD,1,a.valor_efectivo) MATRICULA_EFECTIVO,   \n";
			sql = sql + "  		   		  DECODE (a.TCOM_CCOD,2,a.valor_efectivo) COLEGIATURA_EFECTIVO,   \n";
			sql = sql + "  		   		   a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TCOM_CCOD   \n";
			sql = sql + "  		    from (   \n";
			sql = sql + "  		   		  select sum(ii.INGR_MEFECTIVO) valor_efectivo,car.CARR_CCOD,   \n";
			sql = sql + "  				   car.CARR_TDESC, aa.PERS_NCORR,com.TCOM_CCOD   \n";
			sql = sql + "  					from alumnos aa, contratos cc, compromisos com,    \n";
			sql = sql + "  					detalle_compromisos dc, abonos ab,   \n";
			sql = sql + "  					ingresos ii,   \n";
			sql = sql + "  					ofertas_academicas oo , especialidades ee, carreras car   \n";
			sql = sql + "  					where aa.emat_ccod<>9   \n";
			sql = sql + "  					and cc.CONT_NCORR=com.COMP_NDOCTO   \n";
			sql = sql + "  					and com.TCOM_CCOD=dc.TCOM_CCOD   \n";
			sql = sql + "  					and com.INST_CCOD=dc.INST_CCOD   \n";
			sql = sql + "  					and oo.PERI_CCOD="+periodo;
			sql = sql + "  					and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)   \n";
			sql = sql + "  					and aa.OFER_NCORR=oo.OFER_NCORR   \n";
			sql = sql + "  					and oo.ESPE_CCOD=ee.ESPE_CCOD   \n";
			sql = sql + "  					and ee.CARR_CCOD=car.CARR_CCOD   \n";
			sql = sql + "  					and cc.ECON_CCOD=1   \n";
			sql = sql + "  					and aa.MATR_NCORR=cc.MATR_NCORR   \n";
			sql = sql + "  					and com.ECOM_CCOD=1   \n";
			sql = sql + "  					and com.COMP_NDOCTO=dc.COMP_NDOCTO   \n";
			sql = sql + "  					and dc.TCOM_CCOD=ab.TCOM_CCOD   \n";
			sql = sql + "  					and dc.INST_CCOD=ab.INST_CCOD   \n";
			sql = sql + "  					and dc.COMP_NDOCTO=ab.COMP_NDOCTO   \n";
			sql = sql + "  					and dc.DCOM_NCOMPROMISO=ab.DCOM_NCOMPROMISO   \n";
			sql = sql + "  					and trunc(dc.DCOM_FCOMPROMISO) between nvl(to_date('"+fecha_inicio+"','DD/MM/YYYY'),dc.DCOM_FCOMPROMISO)    \n";
			sql = sql + "  					and nvl(to_date('"+fecha_termino+"','DD/MM/YYYY'),dc.DCOM_FCOMPROMISO)   \n";
			sql = sql + "  					and ii.EING_CCOD=1			   \n";
			sql = sql + "  					and ii.INGR_MEFECTIVO <>0   \n";
			sql = sql + "  					and ab.INGR_NCORR=ii.INGR_NCORR   \n";
			sql = sql + "  					group by car.CARR_CCOD, car.CARR_TDESC,aa.PERS_NCORR,com.TCOM_CCOD   \n";
			sql = sql + "  					) a    \n";
			sql = sql + "  				group by  a.valor_efectivo, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TCOM_CCOD    \n";
			sql = sql + "  				having ano_ingreso_carrera(a.PERS_NCORR,a.CARR_CCOD)= " +ano_actual+"   \n";
			sql = sql + "  				)    \n";
			sql = sql + "  				group by CARR_CCOD,CARR_TDESC	   \n";
			sql = sql + "  )j,		   \n";
			sql = sql + " (  \n";
			sql = sql + "  select CARR_TDESC,CARR_CCOD,sum(credito_m) total_credito_matr_a, sum(beca_m) total_beca_matr_a, sum(descuento_m) total_descuento_matr_a, \n";
			sql = sql + " 	sum(credito_c) total_credito_col_a, sum(beca_c) total_beca_col_a, sum(descuento_c) total_descuento_col_a   \n";
			sql = sql + "  			   from (   \n";
			sql = sql + "  			   select DECODE(a.TBEN_CCOD,1,a.valor_efectivo_matr) CREDITO_M,   \n";
			sql = sql + "  		       		  DECODE(a.TBEN_CCOD,2,a.valor_efectivo_matr) BECA_M,   \n";
			sql = sql + "  			   		  DECODE(a.TBEN_CCOD,3,a.valor_efectivo_matr) DESCUENTO_M ,    \n";
			sql = sql + " 					  DECODE(a.TBEN_CCOD,1,a.valor_efectivo_col) CREDITO_C,   \n";
			sql = sql + "  		       		  DECODE(a.TBEN_CCOD,2,a.valor_efectivo_col) BECA_C,   \n";
			sql = sql + "  			   		  DECODE(a.TBEN_CCOD,3,a.valor_efectivo_col) DESCUENTO_C , \n";
			sql = sql + "  					  a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TBEN_CCOD    \n";
			sql = sql + "  					  from (   \n";
			sql = sql + "  			   		  select sum(DECODE(be.MONE_CCOD,2,   \n";
			sql = sql + "  					  		 			round(be.BENE_MMONTO_ACUM_COLEGIATURA*ufom.UFOM_MVALOR),1,   \n";
			sql = sql + "  										be.BENE_MMONTO_ACUM_COLEGIATURA)) valor_efectivo_col,   \n";
			sql = sql + "  							sum(DECODE(be.MONE_CCOD,2,   \n";
			sql = sql + "  									   round(be.BENE_MMONTO_ACUM_MATRICULA*ufom.UFOM_MVALOR),1,   \n";
			sql = sql + "  									   be.BENE_MMONTO_ACUM_MATRICULA))  		  		      \n";
			sql = sql + "  						    valor_efectivo_matr,car.CARR_CCOD, car.CARR_TDESC, aa.PERS_NCORR,tb.TBEN_CCOD   \n";
			sql = sql + "  							from alumnos aa, contratos cc,    \n";
			sql = sql + "  							beneficios be,stipos_descuentos std, tipos_beneficios tb,    \n";
			sql = sql + "  							ofertas_academicas oo , especialidades ee, carreras car, uf ufom   \n";
			sql = sql + "  							where aa.emat_ccod<>9   \n";
			sql = sql + "  							and oo.PERI_CCOD="+periodo;
			sql = sql + "  							and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)   \n";
			sql = sql + "  							and aa.OFER_NCORR=oo.OFER_NCORR   \n";
			sql = sql + "  							and oo.ESPE_CCOD=ee.ESPE_CCOD   \n";
			sql = sql + "  							and ee.CARR_CCOD=car.CARR_CCOD   \n";
			sql = sql + "  							and cc.ECON_CCOD=1   \n";
			sql = sql + "  							and aa.MATR_NCORR=cc.MATR_NCORR   \n";
			sql = sql + "  							and be.EBEN_CCOD=1   \n";
			sql = sql + "  							and be.CONT_NCORR=cc.CONT_NCORR   \n";
			sql = sql + "  							and trunc(be.BENE_FBENEFICIO) between nvl(to_date('"+fecha_inicio+"','DD/MM/YYYY'),be.BENE_FBENEFICIO)   \n";
			sql = sql + "  							and nvl(to_date('"+fecha_termino+"','DD/MM/YYYY'),be.BENE_FBENEFICIO)   \n";
			sql = sql + "  							and be.STDE_CCOD =std.STDE_CCOD   \n";
			sql = sql + "  							and std.TBEN_CCOD=tb.TBEN_CCOD   \n";
			sql = sql + "  							and be.UFOM_NCORR=ufom.UFOM_NCORR (+)   \n";
			sql = sql + "  							group by car.CARR_CCOD, car.CARR_TDESC,aa.PERS_NCORR,tb.TBEN_CCOD   \n";
			sql = sql + "  						) a    \n";
			sql = sql + "  					group by  a.valor_efectivo_matr,a.valor_efectivo_col, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR, a.TBEN_CCOD   \n";
			sql = sql + "  					having ano_ingreso_carrera(a.PERS_NCORR,a.CARR_CCOD)< " +ano_actual+"   \n";
			sql = sql + "  					)    \n";
			sql = sql + "  					group by CARR_CCOD,CARR_TDESC   \n";
			sql = sql + " ) k,		   \n";
			sql = sql + " (  \n";
			sql = sql + " select CARR_TDESC,CARR_CCOD,sum(credito_m) total_credito_matr_n, sum(beca_m) total_beca_matr_n, sum(descuento_m) total_descuento_matr_n, \n";
			sql = sql + " 	sum(credito_c) total_credito_col_n, sum(beca_c) total_beca_col_n, sum(descuento_c) total_descuento_col_n   \n";
			sql = sql + "  			   from (   \n";
			sql = sql + "  			   select DECODE(a.TBEN_CCOD,1,a.valor_efectivo_matr) CREDITO_M,   \n";
			sql = sql + "  		       		  DECODE(a.TBEN_CCOD,2,a.valor_efectivo_matr) BECA_M,   \n";
			sql = sql + "  			   		  DECODE(a.TBEN_CCOD,3,a.valor_efectivo_matr) DESCUENTO_M ,    \n";
			sql = sql + " 					  DECODE(a.TBEN_CCOD,1,a.valor_efectivo_col) CREDITO_C,   \n";
			sql = sql + "  		       		  DECODE(a.TBEN_CCOD,2,a.valor_efectivo_col) BECA_C,   \n";
			sql = sql + "  			   		  DECODE(a.TBEN_CCOD,3,a.valor_efectivo_col) DESCUENTO_C , \n";
			sql = sql + "  					  a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR,a.TBEN_CCOD    \n";
			sql = sql + "  					  from (   \n";
			sql = sql + "  			   		  select sum(DECODE(be.MONE_CCOD,2,   \n";
			sql = sql + "  					  		 			round(be.BENE_MMONTO_ACUM_COLEGIATURA*ufom.UFOM_MVALOR),1,   \n";
			sql = sql + "  										be.BENE_MMONTO_ACUM_COLEGIATURA)) valor_efectivo_col,   \n";
			sql = sql + "  							sum(DECODE(be.MONE_CCOD,2,   \n";
			sql = sql + "  									   round(be.BENE_MMONTO_ACUM_MATRICULA*ufom.UFOM_MVALOR),1,   \n";
			sql = sql + "  									   be.BENE_MMONTO_ACUM_MATRICULA))  		  		      \n";
			sql = sql + "  						    valor_efectivo_matr,car.CARR_CCOD, car.CARR_TDESC, aa.PERS_NCORR,tb.TBEN_CCOD   \n";
			sql = sql + "  							from alumnos aa, contratos cc,    \n";
			sql = sql + "  							beneficios be,stipos_descuentos std, tipos_beneficios tb,    \n";
			sql = sql + "  							ofertas_academicas oo , especialidades ee, carreras car, uf ufom   \n";
			sql = sql + "  							where aa.emat_ccod<>9   \n";
			sql = sql + "  							and oo.PERI_CCOD="+periodo;
			sql = sql + "  							and oo.SEDE_CCOD=nvl('"+sede+"',oo.SEDE_CCOD)   \n";
			sql = sql + "  							and aa.OFER_NCORR=oo.OFER_NCORR   \n";
			sql = sql + "  							and oo.ESPE_CCOD=ee.ESPE_CCOD   \n";
			sql = sql + "  							and ee.CARR_CCOD=car.CARR_CCOD   \n";
			sql = sql + "  							and cc.ECON_CCOD=1   \n";
			sql = sql + "  							and aa.MATR_NCORR=cc.MATR_NCORR   \n";
			sql = sql + "  							and be.EBEN_CCOD=1   \n";
			sql = sql + "  							and be.CONT_NCORR=cc.CONT_NCORR   \n";
			sql = sql + "  							and trunc(be.BENE_FBENEFICIO) between nvl(to_date('"+fecha_inicio+"','DD/MM/YYYY'),be.BENE_FBENEFICIO)   \n";
			sql = sql + "  							and nvl(to_date('"+fecha_termino+"','DD/MM/YYYY'),be.BENE_FBENEFICIO)   \n";
			sql = sql + "  							and be.STDE_CCOD =std.STDE_CCOD   \n";
			sql = sql + "  							and std.TBEN_CCOD=tb.TBEN_CCOD   \n";
			sql = sql + "  							and be.UFOM_NCORR=ufom.UFOM_NCORR (+)   \n";
			sql = sql + "  							group by car.CARR_CCOD, car.CARR_TDESC,aa.PERS_NCORR,tb.TBEN_CCOD   \n";
			sql = sql + "  						) a    \n";
			sql = sql + "  					group by  a.valor_efectivo_matr,a.valor_efectivo_col, a.CARR_CCOD,a.CARR_TDESC, a.PERS_NCORR, a.TBEN_CCOD   \n";
			sql = sql + "  					having ano_ingreso_carrera(a.PERS_NCORR,a.CARR_CCOD)= " +ano_actual+"   \n";
			sql = sql + "  					)    \n";
			sql = sql + "  					group by CARR_CCOD,CARR_TDESC   \n";
			sql = sql + " ) l	  		   \n";
			sql = sql + "  where  \n";
			sql = sql + "  z.CARR_CCOD=a.CARR_CCOD (+) \n";
			sql = sql + "  and z.CARR_CCOD=b.CARR_CCOD  (+)  \n";
			sql = sql + "  and z.CARR_CCOD=c.CARR_CCOD  (+) \n";
			sql = sql + "  and z.CARR_CCOD=d.CARR_CCOD  (+) \n";
			sql = sql + "  and z.CARR_CCOD=e.CARR_CCOD  (+) \n";
			sql = sql + "  and z.CARR_CCOD=f.CARR_CCOD  (+) \n";
			sql = sql + "  and z.CARR_CCOD=g.CARR_CCOD  (+) \n";
			sql = sql + "  and z.CARR_CCOD=h.CARR_CCOD  (+) \n";
			sql = sql + "  and z.CARR_CCOD=i.CARR_CCOD  (+) \n";
			sql = sql + "  and z.CARR_CCOD=j.CARR_CCOD  (+) \n";
			sql = sql + "  and z.CARR_CCOD=k.CARR_CCOD  (+) \n";
			sql = sql + "  and z.CARR_CCOD=l.CARR_CCOD  (+) \n";
			sql = sql + "  order by z.CARR_TDESC  \n";
			return (sql);
		
		}

/*
		private string EscribirCodigo(string periodo, string fecha_inicio, string fecha_termino, string sede, string ano_actual) {
			string SQL;
			SQL = "";


			SQL = " select a.peri_tdesc as periodo, '" + fecha_inicio + "' as fecha_inicio, '" + fecha_termino + "' as fecha_termino, \n";
			SQL = SQL +  "        a.carr_tdesc, a.carr_ccod, a.sede_tdesc, \n";
			SQL = SQL +  " 	   nvl(b.total_cheque_a, 0) as total_cheque_a, \n";
			SQL = SQL +  " 	   nvl(b.total_letra_a, 0) as total_letra_a, \n";
			SQL = SQL +  " 	   nvl(b.total_cheque_n, 0) as total_cheque_n, \n";
			SQL = SQL +  " 	   nvl(b.total_letra_n, 0) as total_letra_n, \n";
			SQL = SQL +  " 	   nvl(b.efectivo_a, 0) as efectivo_a,  \n";
			SQL = SQL +  " 	   nvl(b.efectivo_n, 0) as efectivo_n,  \n";
			SQL = SQL +  " 	   nvl(c.total_credito_a, 0) as total_credito_a, \n";
			SQL = SQL +  " 	   nvl(c.total_beca_a, 0) as total_beca_a, \n";
			SQL = SQL +  " 	   nvl(c.total_descuento_a, 0) as total_descuento_a, \n";
			SQL = SQL +  " 	   nvl(c.total_credito_n, 0) as total_credito_n,  \n";
			SQL = SQL +  " 	   nvl(c.total_beca_n, 0) as total_beca_n,  \n";
			SQL = SQL +  " 	   nvl(c.total_descuento_n, 0) as total_descuento_n, \n";
			SQL = SQL +  " 	   nvl(b.total_matr_cheque_a, 0) as total_matr_cheque_a,  \n";
			SQL = SQL +  " 	   nvl(b.total_matr_letra_a, 0) as total_matr_letra_a,  \n";
			SQL = SQL +  " 	   nvl(b.total_col_letra_a, 0) as total_col_letra_a,  \n";
			SQL = SQL +  " 	   nvl(b.total_col_cheque_a, 0) as total_col_cheque_a,  \n";
			SQL = SQL +  " 	   nvl(b.total_matr_cheque_n, 0) as total_matr_cheque_n, \n";
			SQL = SQL +  " 	   nvl(b.total_matr_letra_n, 0) as total_matr_letra_n, \n";
			SQL = SQL +  " 	   nvl(b.total_col_letra_n, 0) as total_col_letra_n, \n";
			SQL = SQL +  " 	   nvl(b.total_col_cheque_n, 0) as total_col_cheque_n, \n";
			SQL = SQL +  " 	   nvl(b.total_matr_efectivo_a, 0) as total_matr_efectivo_a, \n";
			SQL = SQL +  " 	   nvl(b.total_col_efectivo_a, 0) as total_col_efectivo_a, \n";
			SQL = SQL +  " 	   nvl(b.total_matr_efectivo_n, 0) as total_matr_efectivo_n, \n";
			SQL = SQL +  " 	   nvl(b.total_col_efectivo_n, 0) as total_col_efectivo_n, \n";
			SQL = SQL +  " 	   nvl(c.total_credito_matr_n, 0) as total_credito_matr_n, \n";
			SQL = SQL +  " 	   nvl(c.total_beca_matr_n, 0) as total_beca_matr_n, \n";
			SQL = SQL +  " 	   nvl(c.total_descuento_matr_n, 0) as total_descuento_matr_n, \n";
			SQL = SQL +  " 	   nvl(c.total_credito_col_n, 0) as total_credito_col_n, \n";
			SQL = SQL +  " 	   nvl(c.total_beca_col_n, 0) as total_beca_col_n, \n";
			SQL = SQL +  " 	   nvl(c.total_descuento_col_n, 0) as total_descuento_col_n, \n";
			SQL = SQL +  " 	   nvl(c.total_credito_matr_a, 0) as total_credito_matr_a, \n";
			SQL = SQL +  " 	   nvl(c.total_beca_matr_a, 0) as total_beca_matr_a, \n";
			SQL = SQL +  " 	   nvl(c.total_descuento_matr_a, 0) as total_descuento_matr_a, \n";
			SQL = SQL +  " 	   nvl(c.total_credito_col_a, 0) as total_credito_col_a,  \n";
			SQL = SQL +  " 	   nvl(c.total_beca_col_a, 0) as total_beca_col_a, \n";
			SQL = SQL +  " 	   nvl(c.total_descuento_col_a, 0) as total_descuento_col_a \n";
			SQL = SQL +  " from ( \n";
			SQL = SQL +  "       select distinct b.peri_tdesc, d.carr_tdesc, d.carr_ccod, e.sede_tdesc  \n";
			SQL = SQL +  " 		from ofertas_academicas a, periodos_academicos b, especialidades c, carreras d, sedes e \n";
			SQL = SQL +  " 		where a.peri_ccod = b.peri_ccod \n";
			SQL = SQL +  " 		  and a.espe_ccod = c.espe_ccod \n";
			SQL = SQL +  " 		  and c.carr_ccod = d.carr_ccod \n";
			SQL = SQL +  " 		  and a.sede_ccod = e.sede_ccod \n";
			SQL = SQL +  " 		  and a.sede_ccod = '" + sede + "' \n";
			SQL = SQL +  " 		  and a.peri_ccod = '" + periodo + "' \n";
			SQL = SQL +  " 	 ) a, \n";
			SQL = SQL +  " 	 ( \n";
			SQL = SQL +  " 	  select i.carr_ccod, \n";
			SQL = SQL +  " 		       sum(case when c.ting_ccod = 4 and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_letra_a, \n";
			SQL = SQL +  " 			   sum(case when c.ting_ccod = 3 and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_cheque_a, \n";
			SQL = SQL +  " 			   sum(case when c.ting_ccod is null and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as efectivo_a, \n";
			SQL = SQL +  " 			   sum(case when c.ting_ccod = 4 and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_letra_n, \n";
			SQL = SQL +  " 			   sum(case when c.ting_ccod = 3 and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_cheque_n, \n";
			SQL = SQL +  " 			   sum(case when c.ting_ccod is null and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as efectivo_n, \n";
			SQL = SQL +  " 			   sum(case when a.tcom_ccod_origen = 1 and c.ting_ccod = 4 and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_matr_letra_a, \n";
			SQL = SQL +  " 			   sum(case when a.tcom_ccod_origen = 1 and c.ting_ccod = 3 and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_matr_cheque_a, \n";
			SQL = SQL +  " 			   sum(case when a.tcom_ccod_origen = 1 and c.ting_ccod is null and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_matr_efectivo_a, \n";
			SQL = SQL +  " 			   sum(case when a.tcom_ccod_origen = 2 and c.ting_ccod = 4 and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_col_letra_a, \n";
			SQL = SQL +  " 			   sum(case when a.tcom_ccod_origen = 2 and c.ting_ccod = 3 and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_col_cheque_a, \n";
			SQL = SQL +  " 			   sum(case when a.tcom_ccod_origen = 2 and c.ting_ccod is null and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_col_efectivo_a,	    \n";
			SQL = SQL +  " 			   sum(case when a.tcom_ccod_origen = 1 and c.ting_ccod = 4 and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_matr_letra_n, \n";
			SQL = SQL +  " 			   sum(case when a.tcom_ccod_origen = 1 and c.ting_ccod = 3 and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_matr_cheque_n, \n";
			SQL = SQL +  " 			   sum(case when a.tcom_ccod_origen = 1 and c.ting_ccod is null and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_matr_efectivo_n, \n";
			SQL = SQL +  " 			   sum(case when a.tcom_ccod_origen = 2 and c.ting_ccod = 4 and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_col_letra_n, \n";
			SQL = SQL +  " 			   sum(case when a.tcom_ccod_origen = 2 and c.ting_ccod = 3 and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_col_cheque_n, \n";
			SQL = SQL +  " 			   sum(case when a.tcom_ccod_origen = 2 and c.ting_ccod is null and es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_col_efectivo_n	       \n";
			SQL = SQL +  " 		from (	 \n";
			SQL = SQL +  " 		        select b.tdet_ccod, a.tcom_ccod, a.inst_ccod, a.comp_ndocto, a.comp_ndocto as comp_ndocto_origen, a.tcom_ccod as tcom_ccod_origen \n";
			SQL = SQL +  " 				from compromisos a, detalles b, tipos_detalle c \n";
			SQL = SQL +  " 				where a.tcom_ccod = b.tcom_ccod \n";
			SQL = SQL +  " 				  and a.inst_ccod = b.inst_ccod \n";
			SQL = SQL +  " 				  and a.comp_ndocto = b.comp_ndocto \n";
			SQL = SQL +  " 				  and b.tdet_ccod = c.tdet_ccod \n";
			SQL = SQL +  " 				  and a.tcom_ccod = c.tcom_ccod \n";
			SQL = SQL +  " 				  and a.tcom_ccod in (1, 2) \n";
			SQL = SQL +  " 				  and a.ecom_ccod = 1 \n";
			SQL = SQL +  " 				union all \n";
			SQL = SQL +  " 				select c.tdet_ccod, b.tcom_ccod, b.inst_ccod, b.comp_ndocto, a.comp_ndocto_origen, a.tcom_ccod_origen \n";
			SQL = SQL +  " 				from repactaciones a, compromisos b, detalles c, tipos_detalle d \n";
			SQL = SQL +  " 				where a.repa_ncorr = b.comp_ndocto \n";
			SQL = SQL +  " 				  and a.tcom_ccod_origen = c.tcom_ccod \n";
			SQL = SQL +  " 				  and a.comp_ndocto_origen = c.comp_ndocto \n";
			SQL = SQL +  " 				  and c.tdet_ccod = d.tdet_ccod \n";
			SQL = SQL +  " 				  and d.tcom_ccod = a.tcom_ccod_origen \n";
			SQL = SQL +  " 				  and b.tcom_ccod = 3 \n";
			SQL = SQL +  " 				  and a.tcom_ccod_origen in (1, 2) \n";
			SQL = SQL +  " 				  and b.ecom_ccod = 1 \n";
			SQL = SQL +  " 		     ) a, detalle_compromisos b, detalle_ingresos c, \n";
			SQL = SQL +  " 			 contratos e, alumnos f, ofertas_academicas g, especialidades h, carreras i \n";
			SQL = SQL +  " 		where a.tcom_ccod = b.tcom_ccod \n";
			SQL = SQL +  " 		  and a.inst_ccod = b.inst_ccod \n";
			SQL = SQL +  " 		  and a.comp_ndocto = b.comp_ndocto \n";
			SQL = SQL +  " 		  and documento_asociado_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso, 'ingr_ncorr') = c.ingr_ncorr (+) \n";
			SQL = SQL +  " 		  and documento_asociado_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso, 'ting_ccod') = c.ting_ccod (+) \n";
			SQL = SQL +  " 		  and documento_asociado_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso, 'ding_ndocto') = c.ding_ndocto (+) \n";
			SQL = SQL +  " 		  and b.dcom_mcompromiso - total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) > 0 \n";
			SQL = SQL +  " 		  and a.comp_ndocto_origen = e.cont_ncorr \n";
			SQL = SQL +  " 		  and e.matr_ncorr = f.matr_ncorr \n";
			SQL = SQL +  " 		  and f.ofer_ncorr = g.ofer_ncorr \n";
			SQL = SQL +  " 		  and g.espe_ccod = h.espe_ccod \n";
			SQL = SQL +  " 		  and h.carr_ccod = i.carr_ccod \n";
			SQL = SQL +  " 		  and b.tcom_ccod in (1, 2, 3)   \n";
			SQL = SQL +  " 		  and e.econ_ccod = 1 \n";
			SQL = SQL +  " 		  and f.emat_ccod <> 9 \n";
			SQL = SQL +  " 		  and b.dcom_fcompromiso between to_date('" + fecha_inicio + "', 'dd/mm/yyyy') and to_date('" + fecha_termino + "', 'dd/mm/yyyy')  \n";
			SQL = SQL +  " 		  and g.peri_ccod = '" + periodo + "' \n";
			SQL = SQL +  " 		  and g.sede_ccod = '" + sede + "' \n";
			SQL = SQL +  " 		group by i.carr_ccod \n";
			SQL = SQL +  " 	) b, \n";
			SQL = SQL +  " 	( \n";
			SQL = SQL +  " 	 select a.carr_ccod, \n";
			SQL = SQL +  " 		       sum(case when f.tben_ccod = 2 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then nvl(sdes_mmatricula, 0) + nvl(sdes_mcolegiatura, 0) else 0 end) as total_beca_a, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 1 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then nvl(sdes_mmatricula, 0) + nvl(sdes_mcolegiatura, 0) else 0 end) as total_credito_a, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 3 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then nvl(sdes_mmatricula, 0) + nvl(sdes_mcolegiatura, 0) else 0 end) as total_descuento_a, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 2 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then nvl(sdes_mmatricula, 0) + nvl(sdes_mcolegiatura, 0) else 0 end) as total_beca_n, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 1 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then nvl(sdes_mmatricula, 0) + nvl(sdes_mcolegiatura, 0) else 0 end) as total_credito_n, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 3 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then nvl(sdes_mmatricula, 0) + nvl(sdes_mcolegiatura, 0) else 0 end) as total_descuento_n,	    \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 1 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then nvl(sdes_mmatricula, 0) else 0 end) as total_credito_matr_n, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 2 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then nvl(sdes_mmatricula, 0) else 0 end) as total_beca_matr_n, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 3 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then nvl(sdes_mmatricula, 0) else 0 end) as total_descuento_matr_n, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 1 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then nvl(sdes_mcolegiatura, 0) else 0 end) as total_credito_col_n, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 2 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then nvl(sdes_mcolegiatura, 0) else 0 end) as total_beca_col_n, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 3 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then nvl(sdes_mcolegiatura, 0) else 0 end) as total_descuento_col_n,	    \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 1 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then nvl(sdes_mmatricula, 0) else 0 end) as total_credito_matr_a, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 2 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then nvl(sdes_mmatricula, 0) else 0 end) as total_beca_matr_a, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 3 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then nvl(sdes_mmatricula, 0) else 0 end) as total_descuento_matr_a, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 1 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then nvl(sdes_mcolegiatura, 0) else 0 end) as total_credito_col_a, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 2 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then nvl(sdes_mcolegiatura, 0) else 0 end) as total_beca_col_a, \n";
			SQL = SQL +  " 			   sum(case when f.tben_ccod = 3 and es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then nvl(sdes_mcolegiatura, 0) else 0 end) as total_descuento_col_a	    \n";
			SQL = SQL +  " 		from especialidades a, ofertas_academicas b, alumnos c, contratos d, beneficios e, tipos_detalle f, \n";
			SQL = SQL +  " 		     pagares g, sdescuentos h \n";
			SQL = SQL +  " 		where a.espe_ccod = b.espe_ccod \n";
			SQL = SQL +  " 		  and b.ofer_ncorr = c.ofer_ncorr \n";
			SQL = SQL +  " 		  and c.matr_ncorr = d.matr_ncorr \n";
			SQL = SQL +  " 		  and d.cont_ncorr = e.cont_ncorr \n";
			SQL = SQL +  " 		  and e.stde_ccod = f.tdet_ccod \n";
			SQL = SQL +  " 		  and e.paga_ncorr = g.paga_ncorr (+) \n";
			SQL = SQL +  " 		  and nvl(g.epag_ccod, 0) not in (6, 8) \n";
			SQL = SQL +  " 		  and c.post_ncorr = h.post_ncorr \n";
			SQL = SQL +  " 		  and c.ofer_ncorr = h.ofer_ncorr \n";
			SQL = SQL +  " 		  and e.stde_ccod = h.stde_ccod \n";
			SQL = SQL +  " 		  and e.eben_ccod = 1 \n";
			SQL = SQL +  " 		  and c.emat_ccod <> 9 \n";
			SQL = SQL +  " 		  and d.econ_ccod = 1 \n";
			SQL = SQL +  " 		  and b.sede_ccod = '" + sede + "'   \n";
			SQL = SQL +  " 		  and b.peri_ccod = '" + periodo + "' \n";
			SQL = SQL +  " 		  and e.bene_fbeneficio between to_date('" + fecha_inicio + "', 'dd/mm/yyyy') and to_date('" + fecha_termino + "', 'dd/mm/yyyy') \n";
			SQL = SQL +  " 		group by a.carr_ccod \n";
			SQL = SQL +  " 	) c \n";
			SQL = SQL +  " where a.carr_ccod = b.carr_ccod (+) \n";
			SQL = SQL +  "   and a.carr_ccod = c.carr_ccod (+) \n";
			SQL = SQL +  " order by a.carr_tdesc asc \n";
SQL="";

			SQL = " select a.peri_tdesc as periodo, '" + fecha_inicio + "' as fecha_inicio, '" + fecha_termino + "' as fecha_termino, ";
			SQL = SQL +  "      a.carr_tdesc, a.carr_ccod, a.sede_tdesc, ";
			SQL = SQL +  "	   isnull(b.total_cheque_a, 0) as total_cheque_a, ";
			SQL = SQL +  "	   isnull(b.total_letra_a, 0) as total_letra_a, ";
			SQL = SQL +  "	   isnull(b.total_cheque_n, 0) as total_cheque_n, ";
			SQL = SQL +  "	   isnull(b.total_letra_n, 0) as total_letra_n, ";
			SQL = SQL +  "	   isnull(b.efectivo_a, 0) as efectivo_a,  ";
			SQL = SQL +  "	   isnull(b.efectivo_n, 0) as efectivo_n,  ";
			SQL = SQL +  "	   isnull(c.total_credito_a, 0) as total_credito_a, ";
			SQL = SQL +  "	   isnull(c.total_beca_a, 0) as total_beca_a, ";
			SQL = SQL +  "	   isnull(c.total_descuento_a, 0) as total_descuento_a, ";
			SQL = SQL +  "	   isnull(c.total_credito_n, 0) as total_credito_n,  ";
			SQL = SQL +  "	   isnull(c.total_beca_n, 0) as total_beca_n,  ";
			SQL = SQL +  "	   isnull(c.total_descuento_n, 0) as total_descuento_n, ";
			SQL = SQL +  "	   isnull(b.total_matr_cheque_a, 0) as total_matr_cheque_a,  ";
			SQL = SQL +  "	   isnull(b.total_matr_letra_a, 0) as total_matr_letra_a,  ";
			SQL = SQL +  "	   isnull(b.total_col_letra_a, 0) as total_col_letra_a,  ";
			SQL = SQL +  "	   isnull(b.total_col_cheque_a, 0) as total_col_cheque_a,  ";
			SQL = SQL +  "	   isnull(b.total_matr_cheque_n, 0) as total_matr_cheque_n, ";
			SQL = SQL +  "	   isnull(b.total_matr_letra_n, 0) as total_matr_letra_n, ";
			SQL = SQL +  "	   isnull(b.total_col_letra_n, 0) as total_col_letra_n, ";
			SQL = SQL +  "	   isnull(b.total_col_cheque_n, 0) as total_col_cheque_n, ";
			SQL = SQL +  "	   isnull(b.total_matr_efectivo_a, 0) as total_matr_efectivo_a, ";
			SQL = SQL +  "	   isnull(b.total_col_efectivo_a, 0) as total_col_efectivo_a, ";
			SQL = SQL +  "	   isnull(b.total_matr_efectivo_n, 0) as total_matr_efectivo_n, ";
			SQL = SQL +  "	   isnull(b.total_col_efectivo_n, 0) as total_col_efectivo_n, ";
			SQL = SQL +  "	   isnull(c.total_credito_matr_n, 0) as total_credito_matr_n, ";
			SQL = SQL +  "	   isnull(c.total_beca_matr_n, 0) as total_beca_matr_n, ";
			SQL = SQL +  "	   isnull(c.total_descuento_matr_n, 0) as total_descuento_matr_n, ";
			SQL = SQL +  "	   isnull(c.total_credito_col_n, 0) as total_credito_col_n, ";
			SQL = SQL +  "	   isnull(c.total_beca_col_n, 0) as total_beca_col_n, ";
			SQL = SQL +  "	   isnull(c.total_descuento_col_n, 0) as total_descuento_col_n, ";
			SQL = SQL +  "	   isnull(c.total_credito_matr_a, 0) as total_credito_matr_a, ";
			SQL = SQL +  "	   isnull(c.total_beca_matr_a, 0) as total_beca_matr_a, ";
			SQL = SQL +  "	   isnull(c.total_descuento_matr_a, 0) as total_descuento_matr_a, ";
			SQL = SQL +  "	   isnull(c.total_credito_col_a, 0) as total_credito_col_a,  ";
			SQL = SQL +  "	   isnull(c.total_beca_col_a, 0) as total_beca_col_a, ";
			SQL = SQL +  "	   isnull(c.total_descuento_col_a, 0) as total_descuento_col_a ";
			SQL = SQL +  " from ( ";
			SQL = SQL +  "      select distinct b.peri_tdesc, d.carr_tdesc, d.carr_ccod, e.sede_tdesc  ";
			SQL = SQL +  "		from ofertas_academicas a, periodos_academicos b, especialidades c, carreras d, sedes e ";
			SQL = SQL +  "		where a.peri_ccod = b.peri_ccod ";
			SQL = SQL +  "		  and a.espe_ccod = c.espe_ccod ";
			SQL = SQL +  "		  and c.carr_ccod = d.carr_ccod ";
			SQL = SQL +  "		  and a.sede_ccod = e.sede_ccod ";
			SQL = SQL +  "		  and a.sede_ccod = '" + sede + "' ";
			SQL = SQL +  "		  and a.peri_ccod = '" + periodo + "' ";
			SQL = SQL +  "	 ) a, ";
			SQL = SQL +  "	 ( ";
			SQL = SQL +  "	  select i.carr_ccod, ";
			SQL = SQL +  "		       sum(case when c.ting_ccod = 4 and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_letra_a, ";
			SQL = SQL +  "			   sum(case when c.ting_ccod = 3 and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_cheque_a, ";
			SQL = SQL +  "			   sum(case when c.ting_ccod is null and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as efectivo_a, ";
			SQL = SQL +  "			   sum(case when c.ting_ccod = 4 and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_letra_n, ";
			SQL = SQL +  "			   sum(case when c.ting_ccod = 3 and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_cheque_n, ";
			SQL = SQL +  "			   sum(case when c.ting_ccod is null and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as efectivo_n, ";
			SQL = SQL +  "			   sum(case when a.tcom_ccod_origen = 1 and c.ting_ccod = 4 and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_matr_letra_a, ";
			SQL = SQL +  "			   sum(case when a.tcom_ccod_origen = 1 and c.ting_ccod = 3 and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_matr_cheque_a, ";
			SQL = SQL +  "			   sum(case when a.tcom_ccod_origen = 1 and c.ting_ccod is null and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_matr_efectivo_a, ";
			SQL = SQL +  "			   sum(case when a.tcom_ccod_origen = 2 and c.ting_ccod = 4 and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_col_letra_a, ";
			SQL = SQL +  "			   sum(case when a.tcom_ccod_origen = 2 and c.ting_ccod = 3 and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_col_cheque_a, ";
			SQL = SQL +  "			   sum(case when a.tcom_ccod_origen = 2 and c.ting_ccod is null and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'N' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_col_efectivo_a,	";  
			SQL = SQL +  "			   sum(case when a.tcom_ccod_origen = 1 and c.ting_ccod = 4 and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_matr_letra_n, ";
			SQL = SQL +  "			   sum(case when a.tcom_ccod_origen = 1 and c.ting_ccod = 3 and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_matr_cheque_n, ";
			SQL = SQL +  "			   sum(case when a.tcom_ccod_origen = 1 and c.ting_ccod is null and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_matr_efectivo_n, ";
			SQL = SQL +  "			   sum(case when a.tcom_ccod_origen = 2 and c.ting_ccod = 4 and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_col_letra_n, ";
			SQL = SQL +  "			   sum(case when a.tcom_ccod_origen = 2 and c.ting_ccod = 3 and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_col_cheque_n, ";
			SQL = SQL +  "			   sum(case when a.tcom_ccod_origen = 2 and c.ting_ccod is null and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, '" + periodo + "') = 'S' then b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) else 0 end) as total_col_efectivo_n ";       
			SQL = SQL +  "		from (	 ";
			SQL = SQL +  "		        select b.tdet_ccod, a.tcom_ccod, a.inst_ccod, a.comp_ndocto, a.comp_ndocto as comp_ndocto_origen, a.tcom_ccod as tcom_ccod_origen ";
			SQL = SQL +  "				from compromisos a, detalles b, tipos_detalle c ";
			SQL = SQL +  "				where a.tcom_ccod = b.tcom_ccod ";
			SQL = SQL +  "				  and a.inst_ccod = b.inst_ccod ";
			SQL = SQL +  "				  and a.comp_ndocto = b.comp_ndocto ";
			SQL = SQL +  "				  and b.tdet_ccod = c.tdet_ccod ";
			SQL = SQL +  "				  and a.tcom_ccod = c.tcom_ccod ";
			SQL = SQL +  "				  and a.tcom_ccod in (1, 2) ";
			SQL = SQL +  "				  and a.ecom_ccod = 1 ";
			SQL = SQL +  "				union all ";
			SQL = SQL +  "				select c.tdet_ccod, b.tcom_ccod, b.inst_ccod, b.comp_ndocto, a.comp_ndocto_origen, a.tcom_ccod_origen ";
			SQL = SQL +  "				from repactaciones a, compromisos b, detalles c, tipos_detalle d ";
			SQL = SQL +  "				where a.repa_ncorr = b.comp_ndocto ";
			SQL = SQL +  "				  and a.tcom_ccod_origen = c.tcom_ccod ";
			SQL = SQL +  "				  and a.comp_ndocto_origen = c.comp_ndocto ";
			SQL = SQL +  "				  and c.tdet_ccod = d.tdet_ccod ";
			SQL = SQL +  "				  and d.tcom_ccod = a.tcom_ccod_origen ";
			SQL = SQL +  "				  and b.tcom_ccod = 3 ";
			SQL = SQL +  "				  and a.tcom_ccod_origen in (1, 2) ";
			SQL = SQL +  "				  and b.ecom_ccod = 1 ";
			SQL = SQL +  " 		     ) a, detalle_compromisos b, detalle_ingresos c, ";
			SQL = SQL +  "			 contratos e, alumnos f, ofertas_academicas g, especialidades h, carreras i ";
			SQL = SQL +  "		where a.tcom_ccod = b.tcom_ccod ";
			SQL = SQL +  "		  and a.inst_ccod = b.inst_ccod ";
			SQL = SQL +  "		  and a.comp_ndocto = b.comp_ndocto ";
			SQL = SQL +  "		  and protic.documento_asociado_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso, 'ingr_ncorr') *= c.ingr_ncorr  ";
			SQL = SQL +  "		  and protic.documento_asociado_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso, 'ting_ccod') *= c.ting_ccod  ";
			SQL = SQL +  "		  and protic.documento_asociado_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso, 'ding_ndocto') *= c.ding_ndocto "; 
			SQL = SQL +  "		  and b.dcom_mcompromiso - protic.total_rebajar_comp_cuota(b.tcom_ccod, b.inst_ccod, b.comp_ndocto, b.dcom_ncompromiso) > 0 ";
			SQL = SQL +  "		  and a.comp_ndocto_origen = e.cont_ncorr ";
			SQL = SQL +  "		  and e.matr_ncorr = f.matr_ncorr ";
			SQL = SQL +  "		  and f.ofer_ncorr = g.ofer_ncorr ";
			SQL = SQL +  "		  and g.espe_ccod = h.espe_ccod ";
			SQL = SQL +  "		  and h.carr_ccod = i.carr_ccod ";
			SQL = SQL +  "		  and b.tcom_ccod in (1, 2, 3) ";  
			SQL = SQL +  "		  and e.econ_ccod = 1 ";
			SQL = SQL +  "		  and f.emat_ccod <> 9 ";
			SQL = SQL +  "		  and b.dcom_fcompromiso between '" + fecha_inicio + "' and '" + fecha_termino + "' ";
			SQL = SQL +  "		  and g.peri_ccod = '" + periodo + "' ";
			SQL = SQL +  "		  and g.sede_ccod = '1' ";
			SQL = SQL +  "		group by i.carr_ccod ";
			SQL = SQL +  "	) b, ";
			SQL = SQL +  "	( ";
			SQL = SQL +  "	 select a.carr_ccod, ";
			SQL = SQL +  "		       sum(case when f.tben_ccod = 2 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then isnull(sdes_mmatricula, 0) + isnull(sdes_mcolegiatura, 0) else 0 end) as total_beca_a, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 1 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then isnull(sdes_mmatricula, 0) + isnull(sdes_mcolegiatura, 0) else 0 end) as total_credito_a, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 3 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then isnull(sdes_mmatricula, 0) + isnull(sdes_mcolegiatura, 0) else 0 end) as total_descuento_a, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 2 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then isnull(sdes_mmatricula, 0) + isnull(sdes_mcolegiatura, 0) else 0 end) as total_beca_n, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 1 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then isnull(sdes_mmatricula, 0) + isnull(sdes_mcolegiatura, 0) else 0 end) as total_credito_n, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 3 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then isnull(sdes_mmatricula, 0) + isnull(sdes_mcolegiatura, 0) else 0 end) as total_descuento_n, ";	    
			SQL = SQL +  "			   sum(case when f.tben_ccod = 1 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then isnull(sdes_mmatricula, 0) else 0 end) as total_credito_matr_n, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 2 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then isnull(sdes_mmatricula, 0) else 0 end) as total_beca_matr_n, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 3 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then isnull(sdes_mmatricula, 0) else 0 end) as total_descuento_matr_n, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 1 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then isnull(sdes_mcolegiatura, 0) else 0 end) as total_credito_col_n, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 2 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then isnull(sdes_mcolegiatura, 0) else 0 end) as total_beca_col_n, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 3 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'S' then isnull(sdes_mcolegiatura, 0) else 0 end) as total_descuento_col_n, ";	    
			SQL = SQL +  "			   sum(case when f.tben_ccod = 1 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then isnull(sdes_mmatricula, 0) else 0 end) as total_credito_matr_a, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 2 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then isnull(sdes_mmatricula, 0) else 0 end) as total_beca_matr_a, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 3 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then isnull(sdes_mmatricula, 0) else 0 end) as total_descuento_matr_a, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 1 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then isnull(sdes_mcolegiatura, 0) else 0 end) as total_credito_col_a, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 2 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then isnull(sdes_mcolegiatura, 0) else 0 end) as total_beca_col_a, ";
			SQL = SQL +  "			   sum(case when f.tben_ccod = 3 and protic.es_nuevo_carrera(c.pers_ncorr, a.carr_ccod, '" + periodo + "') = 'N' then isnull(sdes_mcolegiatura, 0) else 0 end) as total_descuento_col_a	 ";   
			SQL = SQL +  "		from especialidades a, ofertas_academicas b, alumnos c, contratos d, beneficios e, tipos_detalle f, ";
			SQL = SQL +  "		     pagares g, sdescuentos h ";
			SQL = SQL +  "		where a.espe_ccod = b.espe_ccod ";
			SQL = SQL +  "		  and b.ofer_ncorr = c.ofer_ncorr ";
			SQL = SQL +  "		  and c.matr_ncorr = d.matr_ncorr ";
			SQL = SQL +  "		  and d.cont_ncorr = e.cont_ncorr ";
			SQL = SQL +  "		  and e.stde_ccod = f.tdet_ccod ";
			SQL = SQL +  "		  and e.paga_ncorr *= g.paga_ncorr  ";
			SQL = SQL +  "		  and isnull(g.epag_ccod, 0) not in (6, 8) ";
			SQL = SQL +  "		  and c.post_ncorr = h.post_ncorr ";
			SQL = SQL +  "		  and c.ofer_ncorr = h.ofer_ncorr ";
			SQL = SQL +  "		  and e.stde_ccod = h.stde_ccod ";
			SQL = SQL +  "		  and e.eben_ccod = 1 ";
			SQL = SQL +  "		  and c.emat_ccod <> 9 ";
			SQL = SQL +  "		  and d.econ_ccod = 1 ";
			SQL = SQL +  "		  and b.sede_ccod = '" + sede + "' ";
			SQL = SQL +  "		  and b.peri_ccod = '" + periodo + "' ";
			SQL = SQL +  "		  and e.bene_fbeneficio between '" + fecha_inicio + "' and '" + fecha_termino + "' ";
			SQL = SQL +  "		group by a.carr_ccod ";
			SQL = SQL +  "	) c ";
			SQL = SQL +  " where a.carr_ccod *= b.carr_ccod  ";
			SQL = SQL +  "  and a.carr_ccod *= c.carr_ccod  ";
			SQL = SQL +  " order by a.carr_tdesc asc ";

			return SQL;
		}

*/
		private string EscribirCodigo(string periodo, string fecha_inicio, string fecha_termino, string sede, string ano_actual) 
		{
			string SQL = "";
			SQL = SQL +"select a.peri_tdesc                        as periodo, ";
			SQL = SQL +"       ' " + fecha_inicio + " '              as fecha_inicio, ";
			SQL = SQL +"       ' " + fecha_termino + " '             as fecha_termino, ";
			SQL = SQL +"       a.carr_tdesc, ";
			SQL = SQL +"       a.carr_ccod, ";
			SQL = SQL +"       a.sede_tdesc, ";
			SQL = SQL +"       isnull(b.total_cheque_a, 0)         as total_cheque_a, ";
			SQL = SQL +"       isnull(b.total_letra_a, 0)          as total_letra_a, ";
			SQL = SQL +"       isnull(b.total_cheque_n, 0)         as total_cheque_n, ";
			SQL = SQL +"       isnull(b.total_letra_n, 0)          as total_letra_n, ";
			SQL = SQL +"       isnull(b.efectivo_a, 0)             as efectivo_a, ";
			SQL = SQL +"       isnull(b.efectivo_n, 0)             as efectivo_n, ";
			SQL = SQL +"       isnull(c.total_credito_a, 0)        as total_credito_a, ";
			SQL = SQL +"       isnull(c.total_beca_a, 0)           as total_beca_a, ";
			SQL = SQL +"       isnull(c.total_descuento_a, 0)      as total_descuento_a, ";
			SQL = SQL +"       isnull(c.total_credito_n, 0)        as total_credito_n, ";
			SQL = SQL +"       isnull(c.total_beca_n, 0)           as total_beca_n, ";
			SQL = SQL +"       isnull(c.total_descuento_n, 0)      as total_descuento_n, ";
			SQL = SQL +"       isnull(b.total_matr_cheque_a, 0)    as total_matr_cheque_a, ";
			SQL = SQL +"       isnull(b.total_matr_letra_a, 0)     as total_matr_letra_a, ";
			SQL = SQL +"       isnull(b.total_col_letra_a, 0)      as total_col_letra_a, ";
			SQL = SQL +"       isnull(b.total_col_cheque_a, 0)     as total_col_cheque_a, ";
			SQL = SQL +"       isnull(b.total_matr_cheque_n, 0)    as total_matr_cheque_n, ";
			SQL = SQL +"       isnull(b.total_matr_letra_n, 0)     as total_matr_letra_n, ";
			SQL = SQL +"       isnull(b.total_col_letra_n, 0)      as total_col_letra_n, ";
			SQL = SQL +"       isnull(b.total_col_cheque_n, 0)     as total_col_cheque_n, ";
			SQL = SQL +"       isnull(b.total_matr_efectivo_a, 0)  as total_matr_efectivo_a, ";
			SQL = SQL +"       isnull(b.total_col_efectivo_a, 0)   as total_col_efectivo_a, ";
			SQL = SQL +"       isnull(b.total_matr_efectivo_n, 0)  as total_matr_efectivo_n, ";
			SQL = SQL +"       isnull(b.total_col_efectivo_n, 0)   as total_col_efectivo_n, ";
			SQL = SQL +"       isnull(c.total_credito_matr_n, 0)   as total_credito_matr_n, ";
			SQL = SQL +"       isnull(c.total_beca_matr_n, 0)      as total_beca_matr_n, ";
			SQL = SQL +"       isnull(c.total_descuento_matr_n, 0) as total_descuento_matr_n, ";
			SQL = SQL +"       isnull(c.total_credito_col_n, 0)    as total_credito_col_n, ";
			SQL = SQL +"       isnull(c.total_beca_col_n, 0)       as total_beca_col_n, ";
			SQL = SQL +"       isnull(c.total_descuento_col_n, 0)  as total_descuento_col_n, ";
			SQL = SQL +"       isnull(c.total_credito_matr_a, 0)   as total_credito_matr_a, ";
			SQL = SQL +"       isnull(c.total_beca_matr_a, 0)      as total_beca_matr_a, ";
			SQL = SQL +"       isnull(c.total_descuento_matr_a, 0) as total_descuento_matr_a, ";
			SQL = SQL +"       isnull(c.total_credito_col_a, 0)    as total_credito_col_a, ";
			SQL = SQL +"       isnull(c.total_beca_col_a, 0)       as total_beca_col_a, ";
			SQL = SQL +"       isnull(c.total_descuento_col_a, 0)  as total_descuento_col_a ";
			SQL = SQL +"from   (select distinct b.peri_tdesc, ";
			SQL = SQL +"                        d.carr_tdesc, ";
			SQL = SQL +"                        d.carr_ccod, ";
			SQL = SQL +"                        e.sede_tdesc ";
			SQL = SQL +"        from   ofertas_academicas as a ";
			SQL = SQL +"               inner join periodos_academicos as b ";
			SQL = SQL +"                       on a.peri_ccod = b.peri_ccod ";
			SQL = SQL +"               inner join especialidades as c ";
			SQL = SQL +"                       on a.espe_ccod = c.espe_ccod ";
			SQL = SQL +"               inner join carreras as d ";
			SQL = SQL +"                       on c.carr_ccod = d.carr_ccod ";
			SQL = SQL +"               inner join sedes as e ";
			SQL = SQL +"                       on a.sede_ccod = e.sede_ccod ";
			SQL = SQL +"        where  a.sede_ccod = ' " + sede + " ' ";
			SQL = SQL +"               and a.peri_ccod = ' " + periodo + " ') as a ";
			SQL = SQL +"       left outer join (select i.carr_ccod, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when c.ting_ccod = 4 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(f.pers_ncorr, ";
			SQL = SQL +"                                   h.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'N' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_letra_a, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when c.ting_ccod = 3 ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'N' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_cheque_a, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when c.ting_ccod is null ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'N' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as efectivo_a, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when c.ting_ccod = 4 ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'S' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_letra_n, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when c.ting_ccod = 3 ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'S' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_cheque_n, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when c.ting_ccod is null ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'S' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as efectivo_n, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when a.tcom_ccod_origen = 1 ";
			SQL = SQL +"       and c.ting_ccod = 4 ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'N' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_matr_letra_a, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when a.tcom_ccod_origen = 1 ";
			SQL = SQL +"       and c.ting_ccod = 3 ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'N' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_matr_cheque_a, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when a.tcom_ccod_origen = 1 ";
			SQL = SQL +"       and c.ting_ccod is null ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'N' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_matr_efectivo_a, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when a.tcom_ccod_origen = 2 ";
			SQL = SQL +"       and c.ting_ccod = 4 ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'N' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_col_letra_a, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when a.tcom_ccod_origen = 2 ";
			SQL = SQL +"       and c.ting_ccod = 3 ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'N' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_col_cheque_a, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when a.tcom_ccod_origen = 2 ";
			SQL = SQL +"       and c.ting_ccod is null ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'N' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_col_efectivo_a, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when a.tcom_ccod_origen = 1 ";
			SQL = SQL +"       and c.ting_ccod = 4 ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'S' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_matr_letra_n, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when a.tcom_ccod_origen = 1 ";
			SQL = SQL +"       and c.ting_ccod = 3 ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'S' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_matr_cheque_n, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when a.tcom_ccod_origen = 1 ";
			SQL = SQL +"       and c.ting_ccod is null ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'S' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_matr_efectivo_n, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when a.tcom_ccod_origen = 2 ";
			SQL = SQL +"       and c.ting_ccod = 4 ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'S' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_col_letra_n, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when a.tcom_ccod_origen = 2 ";
			SQL = SQL +"       and c.ting_ccod = 3 ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'S' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_col_cheque_n, ";
			SQL = SQL +"       sum(case ";
			SQL = SQL +"       when a.tcom_ccod_origen = 2 ";
			SQL = SQL +"       and c.ting_ccod is null ";
			SQL = SQL +"       and protic.es_nuevo_carrera(f.pers_ncorr, h.carr_ccod, ";
			SQL = SQL +"       ' " + periodo + " ') ";
			SQL = SQL +"       = 'S' then b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso) ";
			SQL = SQL +"       else 0 ";
			SQL = SQL +"       end) as total_col_efectivo_n ";
			SQL = SQL +"       from   (select b.tdet_ccod, ";
			SQL = SQL +"       a.tcom_ccod, ";
			SQL = SQL +"       a.inst_ccod, ";
			SQL = SQL +"       a.comp_ndocto, ";
			SQL = SQL +"       a.comp_ndocto as comp_ndocto_origen, ";
			SQL = SQL +"       a.tcom_ccod   as tcom_ccod_origen ";
			SQL = SQL +"       from   compromisos as a ";
			SQL = SQL +"       inner join detalles as b ";
			SQL = SQL +"       on a.tcom_ccod = b.tcom_ccod ";
			SQL = SQL +"       and a.inst_ccod = b.inst_ccod ";
			SQL = SQL +"       and a.comp_ndocto = b.comp_ndocto ";
			SQL = SQL +"       inner join tipos_detalle as c ";
			SQL = SQL +"       on b.tdet_ccod = c.tdet_ccod ";
			SQL = SQL +"       and a.tcom_ccod = c.tcom_ccod ";
			SQL = SQL +"       where  a.tcom_ccod in ( 1, 2 ) ";
			SQL = SQL +"       and a.ecom_ccod = 1 ";
			SQL = SQL +"       union all ";
			SQL = SQL +"       select c.tdet_ccod, ";
			SQL = SQL +"       b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       a.comp_ndocto_origen, ";
			SQL = SQL +"       a.tcom_ccod_origen ";
			SQL = SQL +"       from   repactaciones as a ";
			SQL = SQL +"       inner join compromisos as b ";
			SQL = SQL +"       on a.repa_ncorr = b.comp_ndocto ";
			SQL = SQL +"       and b.tcom_ccod = 3 ";
			SQL = SQL +"       and b.ecom_ccod = 1 ";
			SQL = SQL +"       inner join detalles as c ";
			SQL = SQL +"       on a.tcom_ccod_origen = c.tcom_ccod ";
			SQL = SQL +"       and a.comp_ndocto_origen = c.comp_ndocto ";
			SQL = SQL +"       inner join tipos_detalle as d ";
			SQL = SQL +"       on c.tdet_ccod = d.tdet_ccod ";
			SQL = SQL +"       and a.tcom_ccod_origen = d.tcom_ccod ";
			SQL = SQL +"       where  a.tcom_ccod_origen in ( 1, 2 )) as a ";
			SQL = SQL +"       inner join detalle_compromisos as b ";
			SQL = SQL +"       on a.tcom_ccod = b.tcom_ccod ";
			SQL = SQL +"       and a.inst_ccod = b.inst_ccod ";
			SQL = SQL +"       and a.comp_ndocto = b.comp_ndocto ";
			SQL = SQL +"       and b.dcom_mcompromiso - ";
			SQL = SQL +"       protic.total_rebajar_comp_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"                     b.dcom_ncompromiso) ";
			SQL = SQL +"       > 0 ";
			SQL = SQL +"       and b.tcom_ccod in ( 1, 2, 3 ) ";
			SQL = SQL +"       and b.dcom_fcompromiso between ' " + fecha_inicio + " ' and ";
			SQL = SQL +"                       ' " + fecha_termino + " ' ";
			SQL = SQL +"       left outer join detalle_ingresos as c ";
			SQL = SQL +"       on protic.documento_asociado_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"             b.dcom_ncompromiso, 'ingr_ncorr') = ";
			SQL = SQL +"       c.ingr_ncorr ";
			SQL = SQL +"       and protic.documento_asociado_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso, 'ting_ccod') = c.ting_ccod ";
			SQL = SQL +"       and protic.documento_asociado_cuota(b.tcom_ccod, ";
			SQL = SQL +"       b.inst_ccod, ";
			SQL = SQL +"       b.comp_ndocto, ";
			SQL = SQL +"       b.dcom_ncompromiso, 'ding_ndocto') = ";
			SQL = SQL +"       c.ding_ndocto ";
			SQL = SQL +"       inner join contratos as e ";
			SQL = SQL +"       on a.comp_ndocto_origen = e.cont_ncorr ";
			SQL = SQL +"       and e.econ_ccod = 1 ";
			SQL = SQL +"       inner join alumnos as f ";
			SQL = SQL +"       on e.matr_ncorr = f.matr_ncorr ";
			SQL = SQL +"       and f.emat_ccod <> 9 ";
			SQL = SQL +"       inner join ofertas_academicas as g ";
			SQL = SQL +"       on f.ofer_ncorr = g.ofer_ncorr ";
			SQL = SQL +"       and g.peri_ccod = ' " + periodo + " ' ";
			SQL = SQL +"       and g.sede_ccod = '1' ";
			SQL = SQL +"       inner join especialidades as h ";
			SQL = SQL +"       on g.espe_ccod = h.espe_ccod ";
			SQL = SQL +"       inner join carreras as i ";
			SQL = SQL +"       on h.carr_ccod = i.carr_ccod ";
			SQL = SQL +"       group  by i.carr_ccod) as b ";
			SQL = SQL +"                    on a.carr_ccod = b.carr_ccod ";
			SQL = SQL +"       left outer join (select a.carr_ccod, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 2 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'N' then isnull(sdes_mmatricula, 0) ";
			SQL = SQL +"                                              + isnull(sdes_mcolegiatura, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_beca_a, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 1 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'N' then isnull(sdes_mmatricula, 0) ";
			SQL = SQL +"                                              + isnull(sdes_mcolegiatura, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_credito_a, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 3 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'N' then isnull(sdes_mmatricula, 0) ";
			SQL = SQL +"                                              + isnull(sdes_mcolegiatura, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_descuento_a, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 2 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'S' then isnull(sdes_mmatricula, 0) ";
			SQL = SQL +"                                              + isnull(sdes_mcolegiatura, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_beca_n, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 1 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'S' then isnull(sdes_mmatricula, 0) ";
			SQL = SQL +"                                              + isnull(sdes_mcolegiatura, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_credito_n, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 3 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'S' then isnull(sdes_mmatricula, 0) ";
			SQL = SQL +"                                              + isnull(sdes_mcolegiatura, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_descuento_n, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 1 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'S' then isnull(sdes_mmatricula, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_credito_matr_n, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 2 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'S' then isnull(sdes_mmatricula, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_beca_matr_n, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 3 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'S' then isnull(sdes_mmatricula, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_descuento_matr_n, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 1 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'S' then isnull(sdes_mcolegiatura, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_credito_col_n, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 2 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'S' then isnull(sdes_mcolegiatura, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_beca_col_n, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 3 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'S' then isnull(sdes_mcolegiatura, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_descuento_col_n, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 1 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'N' then isnull(sdes_mmatricula, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_credito_matr_a, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 2 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'N' then isnull(sdes_mmatricula, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_beca_matr_a, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 3 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'N' then isnull(sdes_mmatricula, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_descuento_matr_a, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 1 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'N' then isnull(sdes_mcolegiatura, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_credito_col_a, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 2 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'N' then isnull(sdes_mcolegiatura, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_beca_col_a, ";
			SQL = SQL +"                               sum(case ";
			SQL = SQL +"                                     when f.tben_ccod = 3 ";
			SQL = SQL +"                                          and ";
			SQL = SQL +"                                   protic.es_nuevo_carrera(c.pers_ncorr, ";
			SQL = SQL +"                                   a.carr_ccod, ";
			SQL = SQL +"                                   ' " + periodo + " ') ";
			SQL = SQL +"                                   = 'N' then isnull(sdes_mcolegiatura, 0) ";
			SQL = SQL +"                                     else 0 ";
			SQL = SQL +"                                   end) as total_descuento_col_a ";
			SQL = SQL +"                        from   especialidades as a ";
			SQL = SQL +"                               inner join ofertas_academicas as b ";
			SQL = SQL +"                                       on a.espe_ccod = b.espe_ccod ";
			SQL = SQL +"                                          and b.sede_ccod = ' " + sede + " ' ";
			SQL = SQL +"                                          and b.peri_ccod = ' " + periodo + " ' ";
			SQL = SQL +"                               inner join alumnos as c ";
			SQL = SQL +"                                       on b.ofer_ncorr = c.ofer_ncorr ";
			SQL = SQL +"                                          and c.emat_ccod <> 9 ";
			SQL = SQL +"                               inner join contratos as d ";
			SQL = SQL +"                                       on c.matr_ncorr = d.matr_ncorr ";
			SQL = SQL +"                                          and d.econ_ccod = 1 ";
			SQL = SQL +"                               inner join beneficios as e ";
			SQL = SQL +"                                       on d.cont_ncorr = e.cont_ncorr ";
			SQL = SQL +"                                          and e.eben_ccod = 1 ";
			SQL = SQL +"                                          and e.bene_fbeneficio between ";
			SQL = SQL +"                                              ' " + fecha_inicio + " ' and ";
			SQL = SQL +"                                              ' " + fecha_termino + " ' ";
			SQL = SQL +"                               inner join tipos_detalle as f ";
			SQL = SQL +"                                       on e.stde_ccod = f.tdet_ccod ";
			SQL = SQL +"                               left outer join pagares as g ";
			SQL = SQL +"                                            on e.paga_ncorr = g.paga_ncorr ";
			SQL = SQL +"                                               and isnull(g.epag_ccod, 0) not in ";
			SQL = SQL +"                                                   ( 6, 8 ";
			SQL = SQL +"                                                   ) ";
			SQL = SQL +"                               inner join sdescuentos as h ";
			SQL = SQL +"                                       on c.post_ncorr = h.post_ncorr ";
			SQL = SQL +"                                          and c.ofer_ncorr = h.ofer_ncorr ";
			SQL = SQL +"                                          and e.stde_ccod = h.stde_ccod ";
			SQL = SQL +"                        group  by a.carr_ccod) as c ";
			SQL = SQL +"                    on a.carr_ccod = c.carr_ccod ";
			SQL = SQL +"order  by a.carr_tdesc asc ";
			return SQL;
		}


		private void Page_Load(object sender, System.EventArgs e)
		{
			// Introducir aquí el código de usuario para inicializar la página
			// Introducir aquí el código de usuario para inicializar la página
			string sql;
			string periodo;
			string fecha_termino;
			string fecha_inicio;
			string sede;
			string ano_actual;
		    string tipo_informe;
			//string paga_ncorr;
			//string imprimirFinanza;
			//string paga_ncorr_d;
			//int fila = 0;	
			periodo = Request.QueryString["periodo"];
			fecha_inicio = Request.QueryString["fecha_inicio"];
			fecha_termino = Request.QueryString["fecha_termino"];
			sede = Request.QueryString["sede"];
			ano_actual = Request.QueryString["ano_actual"];
            tipo_informe = Request.QueryString["tipo_informe"];
			sql = EscribirCodigo(periodo, fecha_inicio,fecha_termino, sede, ano_actual);

			//Response.Write("<pre>" + sql + "</pre>");
			//Response.End();

			oleDbDataAdapter1.SelectCommand.CommandText = sql;
			oleDbDataAdapter1.Fill(flujoVencimientoDatos1);
					
			//}
			
			//Response.End();
			
			CrystalReport1 reporte = new CrystalReport1();
			
				
			reporte.SetDataSource(flujoVencimientoDatos1);
			VerReporte.ReportSource = reporte;
			if (tipo_informe=="1")
			{
				ExportarPDF(reporte);
			}
			else
			{
				ExportarEXCEL(reporte);
			}
		}

		#region Web Form Designer generated code
		override protected void OnInit(EventArgs e)
		{
			//
			// CODEGEN: llamada requerida por el Diseñador de Web Forms ASP.NET.
			//
			InitializeComponent();
			base.OnInit(e);
		}
		
		/// <summary>
		/// Método necesario para admitir el Diseñador, no se puede modificar
		/// el contenido del método con el editor de código.
		/// </summary>
		private void InitializeComponent()
		{    
			System.Configuration.AppSettingsReader configurationAppSettings = new System.Configuration.AppSettingsReader();
			this.oleDbDataAdapter1 = new System.Data.OleDb.OleDbDataAdapter();
			this.oleDbSelectCommand1 = new System.Data.OleDb.OleDbCommand();
			this.oleDbConnection1 = new System.Data.OleDb.OleDbConnection();
			this.flujoVencimientoDatos1 = new Flujo_Vencimiento_1.FlujoVencimientoDatos();
			((System.ComponentModel.ISupportInitialize)(this.flujoVencimientoDatos1)).BeginInit();
			// 
			// oleDbDataAdapter1
			// 
			this.oleDbDataAdapter1.SelectCommand = this.oleDbSelectCommand1;
			this.oleDbDataAdapter1.TableMappings.AddRange(new System.Data.Common.DataTableMapping[] {
																										new System.Data.Common.DataTableMapping("Table", "flujoVencimiento", new System.Data.Common.DataColumnMapping[] {
																																																							new System.Data.Common.DataColumnMapping("CARR_TDESC", "CARR_TDESC"),
																																																							new System.Data.Common.DataColumnMapping("CARR_CCOD", "CARR_CCOD"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_CHEQUE_A", "TOTAL_CHEQUE_A"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_LETRA_A", "TOTAL_LETRA_A"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_CHEQUE_N", "TOTAL_CHEQUE_N"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_LETRA_N", "TOTAL_LETRA_N"),
																																																							new System.Data.Common.DataColumnMapping("EFECTIVO_A", "EFECTIVO_A"),
																																																							new System.Data.Common.DataColumnMapping("EFECTIVO_N", "EFECTIVO_N"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_CREDITO_A", "TOTAL_CREDITO_A"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_BECA_A", "TOTAL_BECA_A"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_DESCUENTO_A", "TOTAL_DESCUENTO_A"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_CREDITO_N", "TOTAL_CREDITO_N"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_BECA_N", "TOTAL_BECA_N"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_DESCUENTO_N", "TOTAL_DESCUENTO_N"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_MATR_CHEQUE_A", "TOTAL_MATR_CHEQUE_A"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_MATR_LETRA_A", "TOTAL_MATR_LETRA_A"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_COL_LETRA_A", "TOTAL_COL_LETRA_A"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_COL_CHEQUE_A", "TOTAL_COL_CHEQUE_A"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_MATR_CHEQUE_N", "TOTAL_MATR_CHEQUE_N"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_MATR_LETRA_N", "TOTAL_MATR_LETRA_N"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_COL_LETRA_N", "TOTAL_COL_LETRA_N"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_COL_CHEQUE_N", "TOTAL_COL_CHEQUE_N"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_MATR_EFECTIVO_A", "TOTAL_MATR_EFECTIVO_A"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_COL_EFECTIVO_A", "TOTAL_COL_EFECTIVO_A"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_MATR_EFECTIVO_N", "TOTAL_MATR_EFECTIVO_N"),
																																																							new System.Data.Common.DataColumnMapping("TOTAL_COL_EFECTIVO_N", "TOTAL_COL_EFECTIVO_N")})});
			// 
			// oleDbSelectCommand1
			// 
			this.oleDbSelectCommand1.CommandText = @"SELECT '' AS CARR_TDESC, '' AS CARR_CCOD, '' AS TOTAL_CHEQUE_A, '' AS TOTAL_LETRA_A, '' AS TOTAL_CHEQUE_N, '' AS TOTAL_LETRA_N, '' AS EFECTIVO_A, '' AS EFECTIVO_N, '' AS TOTAL_CREDITO_A, '' AS TOTAL_BECA_A, '' AS TOTAL_DESCUENTO_A, '' AS TOTAL_CREDITO_N, '' AS TOTAL_BECA_N, '' AS TOTAL_DESCUENTO_N, '' AS TOTAL_MATR_CHEQUE_A, '' AS TOTAL_MATR_LETRA_A, '' AS TOTAL_COL_LETRA_A, '' AS TOTAL_COL_CHEQUE_A, '' AS TOTAL_MATR_CHEQUE_N, '' AS TOTAL_MATR_LETRA_N, '' AS TOTAL_COL_LETRA_N, '' AS TOTAL_COL_CHEQUE_N, '' AS TOTAL_MATR_EFECTIVO_A, '' AS TOTAL_COL_EFECTIVO_A, '' AS TOTAL_MATR_EFECTIVO_N, '' AS TOTAL_COL_EFECTIVO_N, '' AS TOTAL_CREDITO_MATR_N, '' AS TOTAL_BECA_MATR_N, '' AS TOTAL_DESCUENTO_MATR_N, '' AS TOTAL_CREDITO_COL_N, '' AS TOTAL_BECA_COL_N, '' AS TOTAL_DESCUENTO_COL_N, '' AS TOTAL_CREDITO_MATR_A, '' AS TOTAL_BECA_MATR_A, '' AS TOTAL_DESCUENTO_MATR_A, '' AS TOTAL_CREDITO_COL_A, '' AS TOTAL_BECA_COL_A, '' AS TOTAL_DESCUENTO_COL_A, '' AS PERIODO, '' AS FECHA_INICIO, '' AS FECHA_TERMINO, '' AS SEDE_TDESC FROM DUAL";
			this.oleDbSelectCommand1.Connection = this.oleDbConnection1;
			// 
			// oleDbConnection1
			// 
			this.oleDbConnection1.ConnectionString = ((string)(configurationAppSettings.GetValue("cadenaConexion", typeof(string))));
			// 
			// flujoVencimientoDatos1
			// 
			this.flujoVencimientoDatos1.DataSetName = "FlujoVencimientoDatos";
			this.flujoVencimientoDatos1.Locale = new System.Globalization.CultureInfo("es-ES");
			this.flujoVencimientoDatos1.Namespace = "http://www.tempuri.org/FlujoVencimientoDatos.xsd";
			this.Load += new System.EventHandler(this.Page_Load);
			((System.ComponentModel.ISupportInitialize)(this.flujoVencimientoDatos1)).EndInit();

		}
		#endregion
	}
}
